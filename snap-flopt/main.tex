\documentclass[a4paper,11pt]{article}
\usepackage[utf8]{inputenc}
\input{prelude}
\input{ldef}
\usepackage{eucal}
\usepackage{url}
\usepackage{tikz}
\usepackage{amsfonts,amsmath}
\begin{document}

\title{Verifying Snapping Mechanism - Floating Point Implementation Version}
\author{}

\date{}

\maketitle
In order to verify the differential privacy property of an implementation of the snapping mechanism \cite{mironov2012significance}, we follow the logic rules designed from \cite{barthe2016proving} and the floating point error semantics from \cite{Ramananandro2016unified,Martel2006higher,Becker2018verified,Moscato2017Automatic}.

\section{Preliminary Definitions}
\begin{defn}
[Laplace mechanism \cite{dwork2006calibrating}]
Let $\epsilon > 0$. The Laplace mechanism  $\lapmech_{\epsilon}$: $\real \to \distr(\real)$ is defined by $\lapmech(t) = t + v$, where $v \in \real$ is drawn from the Laplace distribution $\laplace(\frac{1}{\epsilon})$.
\end{defn}




\section{Syntax}
Following are the syntax of the system. The circled operators are rounded operation in floating point computation.
\[\begin{array}{llll}
\mbox{Expr.} & \expr & ::= & \valr ~|~ \valf
	%
	~|~ x ~|~ f(x) ~|~ \expr_1 \oplus \expr_2 
	%
	~|~ \expr_1 \otimes \expr_2 ~|~ \expr_1 \ominus \expr_2 
	%
	~|~ \expr_1 \oslash \expr_2 ~|~ \oln (\expr) ~|~ x \samplel \edistr \\
%
\mbox{Value} & \valv & ::= & \valr ~|~  \valf \\
%
\mbox{Distribution} & \edistr & ::= & \laplace ~|~ \uniform ~|~ \bernoulli \\ 
%
\mbox{Error} & \err & ::= & (\expr_1, \expr_2) \\

\mbox{Condition} & \condition & ::= & 
	%
	\etrue ~|~ \efalse ~|~ \condition_1 \land \condition_2 
	%
	~|~ \condition_1 \lor \condition_2

\end{array}\]


\begin{defn}
[$\snap(a) : A \to \distr(B)$]
The ideal Snapping mechanism $\snap( a)$ is defined as:
\[
	u \xleftarrow{\$} \edistr; y = \oln (u) \oslash \epsilon; s \samplel \{-1, 1\}; z = s \otimes y; x = f(a); w = x \oplus z; w' = \round{w}_{\Lambda}; r = \clamp_B (w')
\]
where $f$ is the query function over input $a \in A$, $\epsilon$ is the privacy budget, $B$ is the clamping bound and $\Lambda$ is the rounding argument satisfying $\lambda = 2^k$ where $2^k$ is the smallest power of 2 greater or equal to the $\frac{1}{\epsilon}$.
\end{defn}

\section{Semantics}
The big step semantics with floating point computation error are shown in Figure. \ref{fig_semantics_abs}.
\begin{figure}
\begin{mathpar}
\inferrule*[right = plus]
{
	(\expr_1, \err, \condition) \bigstep (\valr_1, \err_1)
	\and
	(\expr_2, \err, \condition) \bigstep (\valr_2, \err_2)
}
{
	(\expr_1 \oplus \expr_2, \err, \condition) 
	\bigstep
	(\valr_1 + \valr_2, \err_1 \uplus \err_2 \uplus \err, \condition_1 \land \condition_2 \land \condition)
}
\and
\cdots
\end{mathpar}
\caption{Semantics with Absolutes Floating Point Error \cite{Becker2018verified}}
\label{fig_semantics_abs}
\end{figure}

The big step semantics with relative floating point computation error are shown in Figure. \ref{fig_semantics_rel}.
\begin{figure}
\begin{mathpar}
\inferrule*[right = const]
{
	\valf = \floaten(\valr)
}
{
	\valr
	\bigstep
	\valf, \big( r(1 - \eta), r(1 + \eta) \big)
}
%
\and
%
\inferrule*[right = plus]
{
	\expr_1 \bigstep \valf_1, (\ubar{\valr_1}, \bar{\valr_1})
	\and
	\expr_2 \bigstep \valf_2, (\ubar{\valr_2}, \bar{\valr_2})
}
{
    \expr_1 \oplus \expr_2
    \bigstep \floaten(\valf_1 + \valf_2),
    \big(
    (\ubar{\valr_1} + \ubar{\valr_2})(1 - \eta), 
    (\bar{\valr_1} + \bar{\valr_2})(1 + \eta)
    \big)
}
%
\and
%
\inferrule*[right = times]
{
	\expr_1 \bigstep \valf_1, (\ubar{\valr_1}, \bar{\valr_1})
	\and
	\expr_2 \bigstep \valf_2, (\ubar{\valr_2}, \bar{\valr_2})
}
{
    \expr_1 \otimes \expr_2
    \bigstep \floaten(\valf_1 \times \valf_2),
    \big(
    (\ubar{\valr_1} \times \ubar{\valr_2})(1 - \eta), 
    (\bar{\valr_1} \times \bar{\valr_2})(1 + \eta)
    \big)
}
%
\and
%
\inferrule*[right = sub]
{
	\expr_1 \bigstep \valf_1, (\ubar{\valr_1}, \bar{\valr_1})
	\and
	\expr_2 \bigstep \valf_2, (\ubar{\valr_2}, \bar{\valr_2})
}
{
    \expr_1 \ominus \expr_2
    \bigstep \floaten(\valf_1 - \valf_2),
    \big(
    (\ubar{\valr_1} - \ubar{\valr_2})(1 - \eta), 
    (\bar{\valr_1} - \bar{\valr_2})(1 + \eta)
    \big)
}
\end{mathpar}
\caption{Semantics with Relative Floating Point Error (By Jiawen)}
\label{fig_semantics_rel}
\end{figure}


\section{Main Theorem}


\begin{thm}[The $\snap$ mechanism is $\epsilon-$differentially private]
Consider $\snap(a)$ defined as before, if $\snap(a) = x$ given database $a$ and privacy parameter $\epsilon$, then its actual privacy loss is bounded by $\epsilon + 12 x \epsilon \eta + 2\eta$
\end{thm}

\begin{proof}

Given $\snap(a) = x$ and parameter $\epsilon$, we consider $a'$ be the adjacent database of $a$ satisfying $|f(a) - f(a')| \leq 1$.
Without loss of generalization, we assume $f(a) + 1 = f(a') ~ (\diamond)$.
The proof is developed by cases of the output of $\snap(a)$ mechanism.
	%
	\begin{itemize}
		%
		% \item[\textbf{case}] $\boldsymbol{x = -B}$
		\caseL{$\boldsymbol{x = -B}$}
		%
		Let $b$ be the largest number rounded by $\Lambda$ that is smaller than $B$. Based on the proof of the ideal version, the derivation of this case given $\snap(a) = \snap(a') = x$ is shown as following:
		% \begin{figure}
		\begin{mathpar}
		\inferrule
		{
			\inferrule
			{
				u \in \big( 
				0, 
				\oexp^{\epsilon \otimes 
				(-b \ominus \frac{\Lambda}{2} \ominus f(a))} 
				\big)
				\sim
				u' \in \big( 
				0, 
				\oexp^{\epsilon \otimes 
				(-b \ominus \frac{\Lambda}{2} \ominus f(a'))} 
				\big) 
			}
			{
				\cdots
			}
		}
		{
			\snap(a) = -B 
			\sim \snap(a') = -B
		}
		\end{mathpar}
		% \caption{Derivation of two $\snap$ mechanisms: $\snap(a)$, $\snap(a')$}
		% \label{fig_der_snap1}
		% \end{figure}
		%	
		Following the semantics in Figure \ref{fig_semantics_rel}, we have following evaluation results:
		%
		\[
		u \in \big( 
		0, (\ubar{\valr}, \bar{\valr})
		\big) \land (s = -1)
		%
		\sim u' \in \big(
		0, (\ubar{\valr'}, \bar{\valr'})
		\big) \land (s = -1)
		\]
		%
		\todo{		
		where $\ubar{\valr}, \bar{\valr}, \ubar{\valr'}$ and $\bar{\valr'}$ have following values:
		%
		\[
		\begin{array}{c}
		u \in \Big( 
		0, 
		(
		e^{\epsilon (\frac{-b - \frac{\Lambda}{2}}{1 + \eta} - f(a))(1 + \eta)^2)},
		e^{\epsilon 
		\frac{(-b - \frac{\Lambda}{2})(1 + \eta) - f(a)}
		{(1 + \eta)^2}}
		)
		\Big) \land (s = -1)\\
		%
		\sim u' \in \Big(
		0, 
		(
		e^{\epsilon (\frac{-b - \frac{\Lambda}{2}}{1 + \eta} - f(a'))(1 + \eta)^2)},
		e^{\epsilon 
		\frac{(-b - \frac{\Lambda}{2})(1 + \eta) - f(a')}
		{(1 + \eta)^2}}
		)
		\Big) \land (s = -1)
		\end{array}
		\]
		%		
		Given that the probability is equivalent to the length of the range, we have the ratio between $u$ and $u'$ is bounded by:
		%
		\[
		\frac{u}{u'}
		\leq \frac
		{\frac{1}{2}\bar{\valr}}
		{\frac{1}{2}\ubar{\valr'}}
		= e^{\epsilon( 
		(-b - \frac{\Lambda}{2})(1 + \eta - \frac{1}{1 + \eta})
		+ f(a)((1 + \eta)^2 - \frac{1}{(1 + \eta)^2})
		+ (1 + \eta)^2)}
		\leq e^{\epsilon(1 + \eta)^2 2B}
		? \leq e^{\epsilon + 12 B \epsilon \eta + 2\eta}
		\]
		%
		By the {AxUnif} rule, we have the actual privacy loss is bounded by the same value.
		%
		}
		%
		%
		\caseL{$\boldsymbol{x \in (-B, \round{f(a)}_{\Lambda})}$}
		%
		The derivation of this case is shown as following:
		% in Figure. \ref{fig_der_snap2}
		% \begin{figure}
		\begin{mathpar}
		\inferrule
		{
			\inferrule
			{
				\inferrule
				{
					\inferrule
					{
						u \in \big[ 
						\oexp^{\epsilon \otimes (x \ominus \frac{\Lambda}{2} \ominus f(a))}, 
						\oexp^{\epsilon \otimes (x \oplus \frac{\Lambda}{2} \ominus f(a))} 
						\big)
						\sim
						u' \in \big[ 
						\oexp^{\epsilon \otimes (x \ominus \frac{\Lambda}{2} \ominus f(a'))}, 
						\oexp^{\epsilon \otimes (x \oplus \frac{\Lambda}{2} \ominus f(a'))} 
						\big) 
					}
					{
						\cdots
					}
				}
				{
					\snap''(a) \in [ x \ominus \frac{\Lambda}{2} \ominus f(a), x \oplus \frac{\Lambda}{2} \ominus f(a) ) 
					\sim_{ \_ }
					\snap''(a') \in [ x \ominus \frac{\Lambda}{2} \ominus f(a'), x \oplus \frac{\Lambda}{2} \ominus f(a'))
				}
			}
			{
				\snap'(a) \in [ x \ominus \frac{\Lambda}{2}, x \oplus \frac{\Lambda}{2}) 
				\sim_{ \_  } 
				\snap'(a') \in [ x \ominus \frac{\Lambda}{2}, x \oplus \frac{\Lambda}{2})
			}
		}
		{
			\snap(a) = x 
			\sim \snap(a') = x
		}
		\end{mathpar}
		% \caption{Derivation of two $\snap$ mechanisms: $\snap(a)$, $\snap(a')$}
		% \label{fig_der_snap2}
		% \end{figure}		
		%
		%

		Following the semantics in Figure \ref{fig_semantics_rel}, we have following evaluation results:
		\[
		u \in \big[ 
		(\ubar{\valr_1}, \bar{\valr_1}), 
		(\ubar{\valr_2}, \bar{\valr_2})
		\big) \land (s = -1)
		%
		\sim u' \in \big[
		(\ubar{\valr_1'}, \bar{\valr_1'}), 
		(\ubar{\valr_2'}, \bar{\valr_2'})
		\big) \land (s = -1)
		\]
		%
		\todo{
		%
		where $\ubar{\valr_1}, \bar{\valr_1}, \ubar{\valr_2}, \bar{\valr_2}, \ubar{\valr_1'}, \bar{\valr_1'}, \ubar{\valr_2'} and \bar{\valr_2'}$ have following values:
		%
		\[
		\begin{array}{c}
		u \in \big[ 
		(
		(1 - \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a))(1 - \eta)^2},
		(1 + \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a))(1 + \eta)^2}
		), 
		(
		(1 - \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a))(1 - \eta)^2},
		(1 + \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a))(1 + \eta)^2}
		)
		\big)\\ 
		%
		\sim u' \in \big[
		(
		(1 - \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a'))(1 - \eta)^2},
		(1 + \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a'))(1 + \eta)^2}
		), 
		(
		(1 - \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a'))(1 - \eta)^2},
		(1 + \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a'))(1 + \eta)^2}
		)
		\big)
		\end{array}
		\]
		%
		Given that the probability is equivalent to the length of the range, we have the ratio between $u$ and $u'$ is bounded by:
		%
		\[
		\frac{u}{u'} 
		\leq \frac
		{\bar{\valr_2} - \ubar{\valr_1}}
		{\ubar{\valr_2'} - \bar{\valr_1'}}
		\leq \epsilon + 12 x \epsilon \eta + 2\eta
		\]
		%
		By the {AxUnif} rule, we have the actual privacy loss is bounded by the same value.
		}
		%
		%
		\caseL{$\boldsymbol{x = \round{f(a)}_{\Lambda}}$}
		%
		\begin{mathpar}
		\inferrule
		{
			\inferrule
			{
				u \in 
				\big( 
				\oexp^{\epsilon \otimes 
				(\round{f(a)}_{\Lambda} \ominus \frac{\Lambda}{2} \ominus f(a))}, 
				1
				\big]
				%
				\lor
				%
				\big( 
				\oexp^{\epsilon \otimes 
				(f(a) \ominus \round{f(a)}_{\Lambda} \ominus \frac{\Lambda}{2})}, 
				1
				\big]
				%
				\sim
				%
				u' \in \big( 
				\oexp^{\epsilon \otimes 
				(\round{f(a)}_{\Lambda} \ominus f(a') \ominus \frac{\Lambda}{2})}
				,
				\oexp^{\epsilon \otimes 
				(\round{f(a)}_{\Lambda} \ominus f(a') \oplus \frac{\Lambda}{2})} 
				\big) 
			}
			{
				\cdots
			}
		}
		{
			\snap(a) = x 
			\sim \snap(a') = x
		}
		\end{mathpar}
		%
		%
		Following the semantics in Figure \ref{fig_semantics_rel}, we have following evaluation results:
		\[
		u \in 
		\big[
		(\ubar{\valr_1}, \bar{\valr_1}), 1
		\big] \land (s = -1)
		\lor 
		u \in \big[ 
		(\ubar{\valr_2}, \bar{\valr_2}), 1
		\big]\land (s = 1)
		%
		\sim u' \in \big[
		(\ubar{\valr_1'}, \bar{\valr_1'}), 
		(\ubar{\valr_2'}, \bar{\valr_2'})
		\big) \land (s = -1),
		\]
		%
		\todo{
		%
		where $\ubar{\valr_1}, \bar{\valr_1}, \ubar{\valr_2}, \bar{\valr_2}, \ubar{\valr_1'}, \bar{\valr_1'}, \ubar{\valr_2'} and \bar{\valr_2'}$ have following values:
		%
		% \[
		% \begin{array}{c}
		% u \in \big[ 
		% (
		% (1 - \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a))(1 + \eta)^2}
		% ), 
		% (
		% (1 - \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a))(1 + \eta)^2}
		% )
		% \big)\\ 
		% %
		% \sim u' \in \big[
		% (
		% (1 - \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a'))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a'))(1 + \eta)^2}
		% ), 
		% (
		% (1 - \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a'))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a'))(1 + \eta)^2}
		% )
		% \big)
		% \end{array}
		% \]
		%
		Given that the probability is equivalent to the length of the range, we have the ratio between $u$ and $u'$ is bounded by:
		%
		\[
		\frac{u}{u'} 
		\leq \frac
		{1 - \frac{1}{2}(\ubar{\valr_2} + \ubar{\valr_1})}
		{\frac{1}{2}(\ubar{\valr_2'} - \bar{\valr_1'})}
		\leq \epsilon + 12 x \epsilon \eta + 2\eta
		\]
		%
		By the {AxUnif} rule, we have the actual privacy loss is bounded by the same value.
		}		
		%
		%
		\caseL{$\boldsymbol{x \in (\round{f(a)}_{\Lambda}, \round{f(a')}_{\Lambda})}$}
		%
		\begin{mathpar}
		\inferrule
		{
			\inferrule
			{
				u \in 
				\big( 
				\oexp^{\epsilon \otimes 
				(f(a) \oplus \frac{\Lambda}{2} \ominus \round{f(a)}_{\Lambda})},
				\oexp^{\epsilon \otimes
				(f(a) \ominus \frac{\Lambda}{2} \ominus \round{f(a)}_{\Lambda})}
				\big]
				%
				\sim
				%
				u' \in \big( 
				\oexp^{\epsilon \otimes 
				(\round{f(a)}_{\Lambda} \ominus f(a') \oplus \frac{\Lambda}{2})}
				,
				\oexp^{\epsilon \otimes
				(\round{f(a)}_{\Lambda} \ominus f(a') \ominus \frac{\Lambda}{2})}
				\big) 
			}
			{
				\cdots
			}
		}
		{
			\snap(a) = x
			\sim \snap(a') = x
		}
		\end{mathpar}
		%
		%
		Following the semantics in Figure \ref{fig_semantics_rel}, we have following evaluation results:
		\[
		u \in 
		\big( 
		(\ubar{\valr_1}, \bar{\valr_1}),
		(\ubar{\valr_2}, \bar{\valr_2})
		\big] \land (s = 1)
		%
		\sim u' \in \big[
		(\ubar{\valr_1'}, \bar{\valr_1'}), 
		(\ubar{\valr_2'}, \bar{\valr_2'})
		\big) \land (s = -1),
		\]
		%
		\todo{
		%
		where $\ubar{\valr_1}, \bar{\valr_1}, \ubar{\valr_2}, \bar{\valr_2}, \ubar{\valr_1'}, \bar{\valr_1'}, \ubar{\valr_2'} and \bar{\valr_2'}$ have following values:
		%
		% \[
		% \begin{array}{c}
		% u \in \big[ 
		% (
		% (1 - \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a))(1 + \eta)^2}
		% ), 
		% (
		% (1 - \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a))(1 + \eta)^2}
		% )
		% \big)\\ 
		% %
		% \sim u' \in \big[
		% (
		% (1 - \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a'))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a'))(1 + \eta)^2}
		% ), 
		% (
		% (1 - \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a'))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a'))(1 + \eta)^2}
		% )
		% \big)
		% \end{array}
		% \]
		%
		Given that the probability is equivalent to the length of the range, we have the ratio between $u$ and $u'$ is bounded by:
		%
		\[
		\frac{u}{u'} 
		\leq \frac
		{\frac{1}{2}(\bar{\valr_2} - \ubar{\valr_1})}
		{\frac{1}{2}(\ubar{\valr_2'} - \bar{\valr_1'})}
		\leq \epsilon + 12 x \epsilon \eta + 2\eta
		\]
		%
		By the {AxUnif} rule, we have the actual privacy loss is bounded by the same value.
		}		
		%
		%
		\caseL{$\boldsymbol{x = \round{f(a')}_{\Lambda}}$}
		%
		\begin{mathpar}
		\inferrule
		{
			\inferrule
			{
				u \in 
				\big( 
				\oexp^{\epsilon \otimes 
				(f(a) \ominus \frac{\Lambda}{2} \ominus \round{f(a')}_{\Lambda})},
				\oexp^{\epsilon \otimes
				(f(a) \oplus \frac{\Lambda}{2} \ominus \round{f(a')}_{\Lambda})}
				\big]
				%
				\sim
				%
				u' \in \big( 
				\oexp^{\epsilon \otimes 
				(\round{f(a)}_{\Lambda} \ominus f(a') \ominus \frac{\Lambda}{2})}
				,
				1 \big]
				\lor
				u' \in \big(
				\oexp^{\epsilon \otimes
				(f(a) \ominus \round{f(a')}_{\Lambda} \ominus \frac{\Lambda}{2})}
				1, \big] 
			}
			{
				\cdots
			}
		}
		{
			\snap(a) = x
			\sim \snap(a') = x
		}
		\end{mathpar}
		%
		%
		Following the semantics in Figure \ref{fig_semantics_rel}, we have following evaluation results:
		\[
		u \in 
		\big( 
		(\ubar{\valr_1}, \bar{\valr_1}),
		(\ubar{\valr_2}, \bar{\valr_2})
		\big] \land (s = 1)
		%
		\sim u' \in 
		\big[ (\ubar{\valr_1'}, \bar{\valr_1'}), 1 \big] \land (s = -1)
		\lor
		\big[ (\ubar{\valr_2'}, \bar{\valr_2'}), 1 \big] \land (s = 1),
		\]
		%
		\todo{
		%
		where $\ubar{\valr_1}, \bar{\valr_1}, \ubar{\valr_2}, \bar{\valr_2}, \ubar{\valr_1'}, \bar{\valr_1'}, \ubar{\valr_2'} and \bar{\valr_2'}$ have following values:
		%
		% \[
		% \begin{array}{c}
		% u \in \big[ 
		% (
		% (1 - \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a))(1 + \eta)^2}
		% ), 
		% (
		% (1 - \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a))(1 + \eta)^2}
		% )
		% \big)\\ 
		% %
		% \sim u' \in \big[
		% (
		% (1 - \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a'))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a'))(1 + \eta)^2}
		% ), 
		% (
		% (1 - \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a'))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a'))(1 + \eta)^2}
		% )
		% \big)
		% \end{array}
		% \]
		%
		Given that the probability is equivalent to the length of the range, we have the ratio between $u$ and $u'$ is bounded by:
		%
		\[
		\frac{u}{u'} 
		\leq \frac
		{\frac{1}{2}(\bar{\valr_2} - \ubar{\valr_1})}
		{1 - \frac{1}{2}(\bar{\valr_2'} + \bar{\valr_1'})}
		\leq \epsilon + 12 x \epsilon \eta + 2\eta
		\]
		%
		By the {AxUnif} rule, we have the actual privacy loss is bounded by the same value.
		}
		%
		%
		\caseL{$\boldsymbol{x \in  (\round{f(a')}_{\Lambda}, B)}$}
		%
		\begin{mathpar}
		\inferrule
		{
			\inferrule
			{
				u \in 
				\big( 
				\oexp^{\epsilon \otimes 
				(f(a) \oplus \frac{\Lambda}{2} \ominus x)},
				\oexp^{\epsilon \otimes
				(f(a) \ominus \frac{\Lambda}{2} \ominus x)}
				\big]
				%
				\sim
				%
				u' \in \big( 
				\oexp^{\epsilon \otimes 
				(f(a') \oplus \frac{\Lambda}{2} \ominus x)}
				,
				\oexp^{\epsilon \otimes
				(f(a') \ominus \frac{\Lambda}{2} \ominus x)}
				\big) 
			}
			{
				\cdots
			}
		}
		{
			\snap(a) = x
			\sim \snap(a') = x
		}
		\end{mathpar}
		%
		%
		Following the semantics in Figure \ref{fig_semantics_rel}, we have following evaluation results:
		\[
		u \in 
		\big( 
		(\ubar{\valr_1}, \bar{\valr_1}),
		(\ubar{\valr_2}, \bar{\valr_2})
		\big] \land (s = 1)
		%
		\sim u' \in \big(
		(\ubar{\valr_1'}, \bar{\valr_1'}), 
		(\ubar{\valr_2'}, \bar{\valr_2'})
		\big] \land (s = 1),
		\]
		%
		\todo{
		%
		where $\ubar{\valr_1}, \bar{\valr_1}, \ubar{\valr_2}, \bar{\valr_2}, \ubar{\valr_1'}, \bar{\valr_1'}, \ubar{\valr_2'} and \bar{\valr_2'}$ have following values:
		%
		% \[
		% \begin{array}{c}
		% u \in \big[ 
		% (
		% (1 - \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a))(1 + \eta)^2}
		% ), 
		% (
		% (1 - \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a))(1 + \eta)^2}
		% )
		% \big)\\ 
		% %
		% \sim u' \in \big[
		% (
		% (1 - \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a'))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x - \frac{\Lambda}{2} - f(a'))(1 + \eta)^2}
		% ), 
		% (
		% (1 - \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a'))(1 - \eta)^2},
		% (1 + \eta) e^{\epsilon(x + \frac{\Lambda}{2} - f(a'))(1 + \eta)^2}
		% )
		% \big)
		% \end{array}
		% \]
		%
		Given that the probability is equivalent to the length of the range, we have the ratio between $u$ and $u'$ is bounded by:
		%
		\[
		\frac{u}{u'} 
		\leq \frac
		{\frac{1}{2}(\bar{\valr_2} - \ubar{\valr_1})}
		{\frac{1}{2}(\ubar{\valr_2'} - \bar{\valr_1'})}
		\leq \epsilon + 12 x \epsilon \eta + 2\eta
		\]
		%
		By the {AxUnif} rule, we have the actual privacy loss is bounded by the same value.
		}
		%		
		%
		\caseL{$\boldsymbol{x = B}$}
		%
		%
		\begin{mathpar}
		\inferrule
		{
			\inferrule
			{
				u \in \big( 
				0, 
				\oexp^{\epsilon \otimes 
				(-b \ominus \frac{\Lambda}{2} \oplus f(a))} 
				\big)
				\sim
				u' \in \big( 
				0, 
				\oexp^{\epsilon \otimes 
				(-b \ominus \frac{\Lambda}{2} \oplus f(a'))} 
				\big) 
			}
			{
				\cdots
			}
		}
		{
			\snap(a) = B 
			\sim \snap(a') = B
		}
		\end{mathpar}
		% \caption{Derivation of two $\snap$ mechanisms: $\snap(a)$, $\snap(a')$}
		% \label{fig_der_snap1}
		% \end{figure}
		%	
		Following the semantics in Figure \ref{fig_semantics_rel}, we have following evaluation results:
		%
		\[
		u \in \big( 
		0, (\ubar{\valr}, \bar{\valr})
		\big)
		%
		\sim u' \in \big(
		0, (\ubar{\valr'}, \bar{\valr'})
		\big),
		\]
		%
		\todo{		
		where $\ubar{\valr}, \bar{\valr}, \ubar{\valr'}$ and $\bar{\valr'}$ have following values:
		%
		%
		Given that the probability is equivalent to the length of the range, we have the ratio between $u$ and $u'$ is bounded by:
		%
		\[
		\frac{u}{u'}
		\leq \frac
		{\frac{1}{2}\bar{\valr}}
		{\frac{1}{2}\ubar{\valr'}}
		\leq \epsilon + 12 x \epsilon \eta + 2\eta
		\]
		%
		By the {AxUnif} rule, we have the actual privacy loss is bounded by the same value.
		}
	%
	%
	%	
	\end{itemize}



\end{proof}


\newpage
\bibliographystyle{plain}
\bibliography{verifysnap.bib}



\end{document}















