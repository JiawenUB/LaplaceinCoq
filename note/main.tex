\documentclass{article}
\usepackage[utf8]{inputenc}
\input{prelude}
\input{ldef}
\begin{document}

\title{Verifying Snapping Mechanism}

\maketitle

\section{Formalization}
\begin{defn}
[$\snap(\mu, a) : \distr(U) \to A \to \distr(B)$]
The ideal Snapping mechanism $\snap(\mu, a)$ is defined as:
\[
	u \xleftarrow{\$} \mu; y = \frac{\ln (u)}{\epsilon}; s \xleftarrow{\$} \{-1, 1\}; z = s * y; x = f(a); w = x + z; w' = \lfloor w \rfloor_{\Lambda}; r = \clamp_B (w')
\]
where $f$ is the query function over input $a \in A$, $\epsilon$ is the privacy budget and $S$ sampled from $ \{-1, +1\}$ with $\mathsf{Bernoulli}(0.5)$.
\end{defn}

\begin{defn}
Let $\epsilon \leq 0$. The $\epsilon${\text -DP divergence} $\Delta_{\epsilon}(\mu_1, \mu_2)$ between two sub-distributions $\mu_1 \in \distr(U)$, $\mu_2 \in \distr(U)$is defined as:
\[	
	\underset{E \in U}{sup}\Big(\pr{x \leftarrow \mu_1}{x \in E} - \exp(\epsilon) \pr{x \leftarrow \mu_2}{x \in \cdot E}]\Big)
\]

\end{defn}

\begin{defn}
[$\epsilon$ - dilation].

Let $\epsilon \geq 0$. The $\epsilon$-dilation $D_{\epsilon}(\mu_1, \mu_2)$ between two sub-distributions $\mu_1 \in \distr(U)$, $\mu_2 \in \distr(U)$is defined as:
\[	
	\underset{E \in U}{sup}\Big(\pr{x \leftarrow \mu_1}{x \in E} - \exp(\epsilon) \pr{x \leftarrow \mu_2}{x \in \exp(-\epsilon) \cdot E}]\Big)
\]
\end{defn}

\begin{prop}
[($\epsilon, \delta$)-differential privacy]
For every pair of sub-distributions $\mu_1 \in \distr(U)$, $\mu_2 \in \distr(U)$, s.t. 
\[
D_{\epsilon}(\mu_1, \mu_2) \leq \delta,
\]
The snapping mechanism $\snap(\mu, a) : \distr(U) \to A \to \distr(B)$ is $(\epsilon, \delta)$ - differentially private w.r.t. an adjacency relation $\Phi$ for every two adjacent inputs a, aâ€™ and $\mu_1, \mu_2$
\end{prop}

\begin{proof}
Followed directly by unfolding the $\snap$ mechanism.
\[
	\begin{array}{lll}
	\pr{x \leftarrow \snap(\mu_1, a)}{x = e} 
	& = & \pr
			{u \leftarrow \mu_1}
			{	\lfloor 
				f(a) + \frac{ S \cdot \log(u)}{\epsilon} 
				\rfloor_{\Lambda} = e
			}\\
	& = & \pr
			{ u \leftarrow \mu_1}
		   	{ u \in [
		   		\frac{\exp((e - \frac{\Lambda}{2} - f(a)) \epsilon )}{S},
		   		\frac{\exp((e + \frac{\Lambda}{2} - f(a)) \epsilon )}{S})
		   	}\\
	& \leq & \exp(\epsilon)
			\pr
			{ u \leftarrow \mu_2}
		   	{ u \in \exp(-\epsilon)[
		   		\frac{\exp((e - \frac{\Lambda}{2} - f(a)) \epsilon )}{S},
		   		\frac{\exp((e + \frac{\Lambda}{2} - f(a)) \epsilon )}{S})
		   	}\\
	& = & \exp(\epsilon)
			\pr
			{u \leftarrow \mu_2}
			{	\lfloor 
				f(a') + \frac{ S \cdot \log(u)}{\epsilon} 
				\rfloor_{\Lambda} = e
			}\\
	& = & \exp(\epsilon)
			\pr{x \leftarrow \snap(\mu_2, a')}{x = e} 
	\end{array}
\]
\end{proof}


\begin{defn}
[$(\epsilon, \delta)$ - lifting \cite{barthe2016proving}]
Two sub-distributions $\mu_1 \in \distr(U_1)$, $\mu_2 \in \distr(U_2)$are related by the $(\epsilon, \delta)$ - dilation lifting of $\Psi \subseteq U_1 \times U_2$, written $\mu_1 \Psi^{\#(\epsilon, \delta)} \mu_2$, if there exist two witness sub-distributions $\mu_L \in \distr(U_1 \times U_2)$ and $\mu_R \in \distr(U_1, U_2)$ s.t.:
\begin{enumerate}
	\item $\projl(\mu_L) = \mu_1$ and $\projr(\mu_R) = \mu_2$;
	\item $\supp(\mu_L) \subseteq \Psi$ and $\supp(\mu_R) \subseteq \Psi$; and
	\item $\Delta_{\epsilon}(\mu_L, \mu_R) \leq \delta$.
\end{enumerate}
\end{defn}

\begin{figure}
\begin{mathpar}
\inferrule*[right = AxUNIF]
{
}
{
	u_1 \xleftarrow{\$} \mu \sim_{\epsilon, 0} u_2 \xleftarrow{\$} \mu : T \Rightarrow u_1 = e^{\epsilon} u_2
}
\\\\
\inferrule
{
}
{
	y_1 = \frac{\ln(u_1)}{\epsilon} \sim_{0, 0} y_2 = \frac{\ln(u_2)}{\epsilon} : u_1 = e^{\epsilon} u_2  \Rightarrow y_1 = 1 + y_2
}
\\\\
\inferrule
{
}
{
	s_1 \xleftarrow{\$} \mu \sim_{0, 0} s_1 \xleftarrow{\$} \mu : T \Rightarrow s_1 = s_2
}
\\\\
\inferrule
{
}
{
	z_1 = s_1 * y_1 \sim_{0, 0} z_2 = s_2 * y_2 : s_1 = s_2 \land y_1 = e^{\epsilon} u_2  \Rightarrow z_1 = \epsilon + z_2
}
\\\\
\inferrule
{
}
{
	x_1 = f(a_1) \sim_{0, 0} x_2 = f(a_2) : x_1 = x_2 + 1 \Rightarrow a_1 = a_2 + 1
}
\\\\
\inferrule
{
}
{
	w_1 = x_1 + z_1 \sim_{0, 0} w_2 = x_2 + z_2 : x_1 + 1 = x_2 \land z_1 = z_2 + 1  \Rightarrow w_1 = w_2
}
\\\\
\inferrule
{
}
{
	w'_1 = \lfloor w_1 \rfloor_{\Lambda} 
	\sim_{0, 0} w'_2 = \lfloor w_2 \rfloor_{\Lambda} : w_1 = w_2  \Rightarrow w'_1 = w'_2
}
\\\\
\inferrule
{
}
{
	r_1 = \clamp_B (w'_1) 
	\sim_{0, 0} r_2 = \clamp_B (w'_2)
	: w'_1 = w'_2  \Rightarrow r_1 = r_2
}
\end{mathpar}
\caption{Coupling Derivation of two $\snap$ mechanisms: $\snap(\mu_1, a_1)$, $\snap(\mu_2, a_2)$}
\end{figure}

\begin{thm}
Let $\mu_1 \in \distr(\real)$, $\mu_2 \in \distr(\real)$ whoes pdf.s are defined:
\[
	\pdf_{\mu_1}(x) = \pdf_{\uniform}(x)
\]
\[
	\pdf_{\mu_2}(y) = \pdf_{\uniform}(y)
\]
where $\uniform$ is uniform distribution over $[0, 1)$ whoes $\pdf.$ is defined as:
\[
	\pdf_{\uniform}(x) = 
	\begin{cases}
	1 & x \in [0, 1)\\
	0       & o.w.
	\end{cases}.
\]
Then, $\mu_1 \Psi^{\#(\epsilon, 0)} \mu_2$, where
\[
	\Psi = \{(x,y) \in \real \times \real | x \cdot e^{-\epsilon} = y\}
\]
\end{thm}
\begin{proof}
Existing $\mu_L, \mu_R \in \distr(\real \times \real)$, whose $\pdf.$s are defined:
\[
	\pdf_{\mu_L}(x, y) = 
	\begin{cases}
	\pdf_{\uniform}(x) & (x,y) \in \Psi \land x \in [0, 1)\\
	0       & o.w.
	\end{cases}
\]
\[
	\pdf_{\mu_R}(x, y) = 
	\begin{cases}
	\pdf_{\uniform}(y) & (x,y) \in \Psi \land y \in [0, 1)\\
	0       & o.w.
	\end{cases}.
\]
\begin{itemize}
	\item $\supp(\mu_L) \in \Psi \land \supp(\mu_R) \in \Psi$

	\begin{itemize}
		\item $\supp(\mu_L) \in \Psi$ 

		By definition of the $\pdf$ of $\mu_L$, we have: $\pr{(x,y) \samplel \mu_L}{(x,y) \notin \Psi} = 0$.

		Then we can derive $\supp(\mu_L) \in \Psi$

		\item $\supp(\mu_R) \in \Psi$

		By definition of the $\pdf$ of $\mu_R$, we have: $\pr{(x,y) \samplel \mu_R}{(x,y) \notin \Psi} = 0$.

		Then we can derive $\supp(\mu_L) \in \Psi$

	\end{itemize}		


	\item $\projl(\mu_L) = \mu_1 \land \pi_2(\mu_R) = \mu_2$
	
	\begin{itemize}
		\item $\projl(\mu_L) = \mu_1$ 

		Equivalent to show $\pdf_{\projl(\mu_L)}  = \pdf_{\mu_1}$.

		By definition of the $\projl$ and $\pdf$ of $\mu_L$, we have $\forall x \in \real$:
		\[
			\pdf_{\projl(\mu_L)}(x) = 
			\begin{cases}
			\int_{y}\pdf_{\uniform}(x) & (x,y) \in \Psi \land x \in [0, 1)\\
			0       & o.w.
			\end{cases} 
			= 
			\begin{cases}
			\pdf_{\uniform}(x) & x \in [0, 1)\\
			0       & o.w.
			\end{cases}
			=
			\pdf_{\mu_1}(x)
		\]

		\item $\supp(\mu_R) \in \Psi$

		Equivalent to show$\pdf_{\projr(\mu_R)}  = \pdf_{\mu_2}$.

		By definition of the $\projr$ and $\pdf$ of $\mu_R$, we have $\forall y \in \real$:
		\[
			\pdf_{\projr(\mu_R)}(y) = 
			\begin{cases}
			\int_{x}\pdf_{\uniform}(y) & (x,y) \in \Psi \land y \in [0, 1)\\
			0       & o.w.
			\end{cases} 
			= 
			\begin{cases}
			\pdf_{\uniform}(y) & y \in [0, 1)\\
			0       & o.w.
			\end{cases}
			=
			\pdf_{\mu_2}(y)
		\]
	\end{itemize}	

	\item $\Delta_{\epsilon}(\mu_L, \mu_R) \leq 0$

	By definition of $\epsilon-$DP divergence, we have:
	 \[
	 \begin{array}{ll}
	 \Delta_{\epsilon}(\mu_L, \mu_R) 
	 & = \underset{S}{\psup}
	 \Big(
	 \pr{(x,y) \samplel \mu_L}{(x,y) \in S} - e^{\epsilon} \pr{(x,y) \samplel \mu_R}{(x,y) \in S}
	 \Big) \\
	 & =\underset{S}{\psup}
	 \Big(
	 \int_{(x,y) \in S} \pdf_{\mu_L}(x, y) - e^{\epsilon} \int_{(x,y) \in S} \pdf_{\mu_R}(x, y)
	 \Big)	 
	 \end{array}
	 \]
	 \begin{itemize}
	 	\item[{\bf case}] $S \subseteq \{(x, y) | x \in [0, 1) \land (x, y) \in \Psi\}$:\\
		 \[
		 \begin{array}{ll}
		 \Delta_{\epsilon}(\mu_L, \mu_R) 
		 & = 
		 \int_{(x,y) \in S} \pdf_{\uniform}(x) - e^{\epsilon} \int_{(x,y) \in S} \pdf_{\uniform}(y)\\
		 & = 
		 \int_{(x,y) \in S} \pdf_{\uniform}(x) - e^{\epsilon} \int_{(x,y) \in S} \pdf_{\uniform}(x * e^{-\epsilon})\\ 
		 & = 
		 \int_{(x,y) \in S} \pdf_{\uniform}(x) - e^{\epsilon}* e^{-\epsilon} \int_{(x,y) \in S} \pdf_{\uniform}(x )\\
		 & = 0 
		 \end{array}
		 \]
	 	\item[{\bf case}] $S \subseteq \{(x, y) | x \in [1, e^{\epsilon}) \land (x, y) \in \Psi\}$:\\
		 \[
		 \begin{array}{ll}
		 \Delta_{\epsilon}(\mu_L, \mu_R) 
		 & = 
		 0 - e^{\epsilon} \int_{(x,y) \in S} \pdf_{\uniform}(y)\\
		 & <  0 
		 \end{array}
		 \]
	 	\item[{\bf case}] o.w.\\
		 \[
		 \begin{array}{ll}
		 \Delta_{\epsilon}(\mu_L, \mu_R) 
		 & = 0 - 0 =  0 
		 \end{array}
		 \]	 	

	 \end{itemize}

\end{itemize}
\end{proof}
\newpage
\bibliographystyle{plain}
\bibliography{verifysnap.bib}


\end{document}















