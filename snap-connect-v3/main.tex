\documentclass[a4paper,11pt]{article}
\usepackage[utf8]{inputenc}
\input{prelude}
\input{ldef}
\usepackage{eucal}
\usepackage{url}
\usepackage{tikz}
\usepackage{amsfonts,amsmath}
\usepackage{hyperref}
\begin{document}

\title{Verifying Snapping Mechanism - Connecting Ideal and Flopt}
\author{}

\date{}

\maketitle
In order to verify the differential privacy proeprty of
the snapping mechanism \cite{mironov2012significance},
we follow the logic rules designed from
\cite{barthe2016proving} and connecting 
it with the floating point computation semantics.
\section{Syntax}
\[\begin{array}{llll}
\mbox{Programs} & \prog & ::= & 
	%
     \varx = \expr ~|~ \varx \samplel \edistr
	%
	~|~ \prog ; \prog \\

\mbox{Expr} & \expr & ::= & \rval  ~|~  \fval
	%
	~|~ \varx  ~|~ \expr \bop \expr
	%
	~|~ \uop (\expr) \\
%
\mbox{Binary Operation} & \bop & ::= & + ~|~ - ~|~ \times ~|~ \div \\
%
\mbox{Unary Operation} & \uop & ::= & \ln ~|~ - ~|~ \round{\cdot} 
	%
	~|~ \clamp_B(\cdot) \\
%
\mbox{Value} & \valv & ::= & \fval_{(\rval, \rval)}\\
%
\mbox{Distr} & \edistr & ::= & \uniform(0, 1]
%
	~|~ \uniform\{-1, 1\}\\ 
%
\mbox{Error} & \err & ::= & (\rval, \rval) \\
%
\mbox{Env} & \trsmem & ::= & \cdot ~|~ \trsmem[x \mapsto (\fval_{\err})]\\
%
\mbox{Type} & \tau & ::= & \float ~|~ \real ~|~ \float_{\real \times \real}
\end{array}
\]
where $\rval$ is in domain of real number $\real$, $\rval \in \real$ and $\fval$ is in domain of floating point number $\float$, $\fval \in \float$. Furthermore, the domain of floating point number $\float$ is a subset of $\real$ containing the real number that can be represented in the floating point computation. The type $\float_{\real \times \real}$ represents the base type of expressions. In Env., the variables are mapped to $(\fval_{\err})$ of the type $\float_{\real \times \real}$.


%
\paragraph{Semantics.}
$\boxed{Env \times Expr \to Value }$
%
\[
	\begin{array}{rcl}
	\sem{\expr}_{\trsmem}
	& \in &  
	\big\{\fval_{(\rval_{l}, \rval_{u})} ~|~
	\exists ~~  
	\trsmem,  
	\expr \trsto (\fvalv_{(\rval_{l}, \rval_{u})})\big\}
	\end{array}
\]
%
$
\boxed{Env \times \distr \to 
\distr(Value)}
$
%
\[
	\begin{array}{rcl}
	\sem{\uniform(0, 1]}_{\trsmem}
	& \in & 
	\big\{
	(\fval_{(\rval_{l}, \rval_{u})}) ~|~
	\fval \leftarrow \muniform(0, 1]
	\land \rval_{l} = \rval_{u} = \fval
	\big\}\\
	\sem{\uniform\{-1, 1\}}_{\trsmem}
	& \in & 
	\big\{
	(-1_{(-1, -1)}), (1_{(1, 1)}) ~|~
	each ~ w.p. ~ 0.5 
	\big\}\\	
	\end{array}
\]
%
$\boxed{Env \times prog \to \distr(Env)}$
\[
\begin{array}{rcl}
	%
	\sem{\varx \samplel \edistr}_{\trsmem}
	& = & 
	\elet \fval_{(\rval_{l}, \rval_{u})} = \sem{\edistr}_{\trsmem}
	\ein 
	\unit{\trsmem[\varx \mapsto \fval_{(\rval_{l}, \rval_{u})}]}
	\\
	%
	\sem{\varx = \expr}_{\trsmem}
	& = &  
	~\unit{\trsmem[\varx \mapsto \sem{\expr}_{\trsmem}]}
	\\
	%
	\sem{\prog_1; \prog_2}_{\trsmem}
	& = &  \elet  \trsmem_1 = 
	\sem{\prog_1}_{\trsmem} \ein
	\sem{\prog_2}_{\trsmem_1} 
\end{array}
\]
%
In the semantics, 
%
$\trsmem, \expr \trsto (\fvalv_{\err})$ represents given an environment
%
$\trsmem$, the expression $\expr$
%
is transited to $\fvalv$ with error bound $err = (\rval_{l}, \rval_{u})$
in floating point transition semantics,
%
s.t. $\rval_{l} \leq \fvalv \leq \rval_{u}$.
%
$\trsmem, \prog \trsto \trsmem'$ represents given and environment $\trsmem$,
%
the program $\prog$ is transited to a new environment $\trsmem'$.
%
The $\muniform(0, 1] \in \distr(\float)$ is the uniform distribution over floating point values ranging over $(0, 1]$.
%
%
\section{Judgement and Validity}
%
\begin{defn}
[$\epsilon-$lifting \cite{barthe2016proving}]
Two sub-distributions $\mu_1 \in \distr(U_1)$, $\mu_2 \in \distr(U_2)$ are related by the $\epsilon-$lifting of $\Psi \subseteq U_1 \times U_2$, written $\mu_1 \Psi^{\#(\epsilon)} \mu_2$, if there exist two witness sub-distributions $\mu_L \in \distr(U_1 \times U_2)$ and $\mu_R \in \distr(U_1, U_2)$ s.t.:
\begin{enumerate}
	\item $\projl(\mu_L) = \mu_1$ and $\projr(\mu_R) = \mu_2$;
	\item $\supp(\mu_L) \subseteq \Psi$ and $\supp(\mu_R) \subseteq \Psi$; and
	\item $\Delta_{\epsilon}(\mu_L, \mu_R) \leq 0.0$.
\end{enumerate}
\end{defn}
%
%
\begin{defn}[$\Lambda$ equivalent]
Given two floating point values $\valv_1$ and $\valv_2$, if for some floating point value $\fvalv$ which is a multiple of $\Lambda$:
\[
	\fvalv - \frac{\Lambda}{2} \leq \valv_1 < \fvalv + \frac{\Lambda}{2}
	~~
	\land
	~~
	\fvalv - \frac{\Lambda}{2} \leq \valv_2 < \fvalv + \frac{\Lambda}{2},	
\]
then $\valv_1$ and $\valv_2$ are $\Lambda$ equivalent, i.e., 
$\valv_1 \lameq \valv_2 \lameq \fvalv$.
\end{defn}
%
%
\begin{defn}[tagged variable]
Let $\mathcal{X}\langle 1 \rangle$ and $\mathcal{X}\langle 2 \rangle$ be the sets of tagged variables, finite sets of variable names tagged with $\langle 1 \rangle$ or $\langle 2 \rangle$ respectively:
\[
	\mathcal{X}\langle 1 \rangle = \{\varx\langle 1 \rangle ~|~ x \in \mathcal{X}\}
	~~
	\text{and}
	~~
	\mathcal{X}\langle 2 \rangle = \{\varx\langle 2 \rangle ~|~ x \in \mathcal{X}\},
\]
where $\mathcal{X}$ is a finite set of variable names.
\end{defn}
%
\paragraph{Assertion.} We consider a set $\mathcal{A}$ of assertions (predicates) from first order logic by the following grammar:
\[
\begin{array}{llll}
%
\mbox{Bool Expression} & \bexp & :: = & 
\expr^{i}\langle 1 / 2 \rangle = \expr^i\langle 1 / 2 \rangle 
 ~|~ \expr^i\langle 1 / 2 \rangle < \expr^i\langle 1 / 2 \rangle) \\
 & & &
 ~|~ \expr^i\langle 1 / 2 \rangle \leq \expr^i\langle 1 / 2 \rangle
 ~|~ \expr^i\langle 1 / 2 \rangle \lameq \expr^i\langle 1 / 2 \rangle
	\\
	%
& & &
 ~|~ \expr^i\langle 1 / 2 \rangle = \expr^i\langle 1 / 2 \rangle
 ~|~ \expr^i\langle 1 / 2 \rangle \neq \expr^i\langle 1 / 2 \rangle
	\\
%
\mbox{Assert.} & \mathcal{A} & ::= & \top ~|~ \bot ~|~ \bexp 
	~|~ \bexp \land \bexp ~|~ \bexp \lor \bexp ~|~ \neg \bexp
	~|~ \mathcal{A} \imply \mathcal{A}
\end{array}
\]
%
We typically use capital Greek letters ($\Phi, \Psi, \cdots$) for predicates. 
%
$\expr\langle 1 / 2 \rangle$ denotes an expression where program variables are tagged with $\langle 1 \rangle$ or $\langle 2 \rangle$.
%
$\expr^i\langle 1 / 2 \rangle$ represents an expression where program variables are projected to the $i^{th}$ value from its triples, where $i \in \{1, 2, 3\}$.
%
\paragraph{Assertion Interpretation.} Assertions are interpreted as relations between environments, i.e., set of paired environments. Let $\Phi$ be an assertion,
%
by the definition of $\mathcal{A}$, we have $\sem{\bexp}$ as:
\\
$\sem{\expr^i\langle 1 \rangle 
= \expr^i\langle 2 \rangle} = 
\{(\trsmem_1, \trsmem_2) 
~|~ (\sem{\expr}_{\trsmem_{1}})^i 
= \sem{\expr}_{\trsmem_2})^i \};
%
~~~~~~~
\sem{\expr^i\langle 1 \rangle) 
< \expr^i\langle 2 \rangle)} = 
\{(\trsmem_1, \trsmem_2) ~|~ (\sem{\expr}_{\trsmem_{1}})^i 
< \sem{\expr}_{\trsmem_2})^i \}$;
%
\\
$\sem{\expr^i\langle 1 \rangle) 
\leq \expr^i\langle 2 \rangle)} = 
\{(\trsmem_1, \trsmem_2) ~|~ (\sem{\expr}_{\trsmem_{1}})^i 
\leq \sem{\expr}_{\trsmem_2})^i \};
%
~~~~~
\sem{\expr^i\langle 1 \rangle) 
\lameq \expr^i\langle 2 \rangle)} = 
\{(\trsmem_1, \trsmem_2) ~|~ (\sem{\expr}_{\trsmem_{1}})^i 
\lameq \sem{\expr}_{\trsmem_2})^i \}$
%
\\
$\sem{\expr^i\langle 1 \rangle) 
\neq \expr^i\langle 2 \rangle)} = 
\{(\trsmem_1, \trsmem_2) ~|~ (\sem{\expr}_{\trsmem_{1}})^i 
\neq \sem{\expr}_{\trsmem_2})^i \}$
%
\\
$\sem{\expr^i\langle 1 \rangle) 
= \expr^i\langle 2 \rangle)} = 
\{(\trsmem_1, \trsmem_2) ~|~ (\sem{\expr}_{\trsmem_{1}})^i 
= \sem{\expr}_{\trsmem_2})^i \}$
%
\\
$\sem{\top} = \{(\trsmem_1, \trsmem_2)\}$
%
\\
$\sem{\bot} = \{\}$
%
\\
$\sem{\bexp_1 \land \bexp_2} = \big\{(\trsmem_1, \trsmem_2)
~|~ (\trsmem_1, \trsmem_2) \in \sem{\bexp_1} \land 
	(\trsmem_1, \trsmem_2) \in \sem{\bexp_2} \big\}$
%
\\
$\sem{\bexp_1 \lor \bexp_2} = \big\{(\trsmem_1, \trsmem_2)
~|~ (\trsmem_1, \trsmem_2) \in \sem{\bexp_1} \lor 
	(\trsmem_1, \trsmem_2) \in \sem{\bexp_2} \big\}$
%
\\
$\sem{\neg \bexp} = \big\{(\trsmem_1, \trsmem_2)
~|~ (\trsmem_1, \trsmem_2) \notin \sem{\bexp} \big\}$
%
%
%
\paragraph{Judgment.}
The judgments are defined in following form:
\[
	\prog_1 \sim_{\epsilon} \prog_2: \Phi \Rightarrow \Psi.
\]
Here, $\prog_1$ and $\prog_2$ are programs and $\Phi$ and $\Psi$ are assertions on pairs of memories. Each assertions can refer to two copies $x\langle 1 \rangle, x\langle 2 \rangle$ of each program variable $x$, where these tagged variables refer to the value of x in the execution of $\prog_1$ and $\prog_2$ respectively.
%
\\
A judgment is valid, written $\vdash \prog_1 \sim_{\epsilon} \prog_2: \Phi_0 \Rightarrow \Phi$, 
if for any two environments $\trsmem_1$ and $\trsmem_2$ satisfying precondition $\Phi_0$, 
i.e., $(\trsmem_1, \trsmem_2) \in \sem{\Phi_0}$, there exists a lifting of $\Phi$ relating the output distributions: 
%
$(\sem{\prog_1}_{\trsmem_1})$ 
$\sem{\Phi}^{\#(\epsilon)}$ 
$(\sem{\prog_2}_{\trsmem_2})$.
%
\\
%
Fig. \ref{fig:aprhl} presents the main rules from apRHL+ \cite{barthe2016proving} excluding the while and condition rules which is not defined in out syntax, as well as the sampling rule, which we generalized in extended apRHL.
The rule in Fig. \ref{fig:aprhlplus} represents the lifting proved in soundness theorem.
%
\begin{figure}[ht]
\boxed{\vdash: prog \times prog \times \real \times Assert \times Assert, ~~ \Phi: Env \times Env \to bool}\\
\boxed{ Value \times Value \times Value \to Value, ~~ i = 1, 2, 3}
\begin{mathpar}
\inferrule
{
	\forall \rvalL, \rvalR \in [0,1]^{\real}
}
{
	\vdash
	\varx \samplel \uniform(0, 1] 	
	\sim_{\epsilon} 
	\vary \samplel \uniform(0, 1]
	:
	\top
	\Rightarrow
	\rvalL \leq \varx^1 \langle 1 \rangle \leq \rvalR 
	\imply
	(e^{\epsilon} \rvalL \leq \vary^1 \langle 2 \rangle \leq e^{\epsilon}\rvalR \land \vary^1 \langle 2 \rangle \leq 1)	
}
~\textbf{Unif+}
\and
\inferrule
{
	\forall \rvalL, \rvalR \in [0,1]^{\real}
}
{
	\vdash
	\varx \samplel \uniform(0, 1] 	
	\sim_{\epsilon} 
	\vary \samplel \uniform(0, 1]
	:
	\top
	\Rightarrow
	\rvalL \leq \varx^1 \langle 1 \rangle \leq \rvalR 
	\imply
	e^{-\epsilon} \rvalL \leq \vary^1 \langle 2 \rangle \leq e^{-\epsilon}\rvalR 	
}
~\textbf{Unif-}
\and
%
\inferrule
{
\empty
}
{
	\vdash 
	\varx_1 \samplel \edistr
	\sim_{0} 
	\varx_2 \samplel \edistr
	: \top \Rightarrow 
	(\varx_2^1\langle 2 \rangle) 
	= (\varx_1^1\langle 1 \rangle )
	\land (\varx_2^2\langle 2 \rangle) = (\varx_1^2\langle 1 \rangle)
	\land (\varx_2^3\langle 2 \rangle) = (\varx_1^3\langle 1 \rangle)
}~\textbf{Null}
\and
\inferrule
{
\empty
}
{
	\vdash 
	\varx_1 = \round{\vary_1}_{\Lambda}	
	\sim_{0} 
	\varx_2 = \round{\vary_2}_{\Lambda}
	: \vary_1 \langle 1 \rangle) \lameq 
	(\vary_2 \langle 2 \rangle)
	\Rightarrow 
	(\varx_2 \langle 2 \rangle) = (\varx_1 \langle 1 \rangle)
}~\textbf{Round}
\end{mathpar}
\caption{Rules Extended from apRHL+}
\label{fig:aprhlplus}
\end{figure}
%
\begin{figure}[ht]
\begin{mathpar}
\inferrule
{
\empty
}
{
	\vdash 
	\varx_1 = \expr_1  
	\sim_{0} 
	\varx_2 = \expr_2  
	: \Phi[\expr_1/\varx_1\langle 1 \rangle]
	[\expr_2/\varx_2\langle 2 \rangle]  \Rightarrow \Phi
}~\textbf{Assn}
~~~
\inferrule
{
\prog_1 \sim_{\epsilon} \prog_2 : \Phi_1 \Rightarrow \Phi'_1
\\
\prog'_1 \sim_{\epsilon'} \prog'_2 : \Phi'_1 \Rightarrow \Phi_2
}
{
	\vdash 
	\prog_1; \prog'_1  
	\sim_{\epsilon + \epsilon'} 
	\prog_2; \prog'_2
	: \Phi_1  \Rightarrow  \Phi_2
}~\textbf{Seq}
\and
\inferrule
{
\prog_1 \sim_{\epsilon} \prog_2 : \Phi'_1 \Rightarrow \Phi'_2
\and
\Phi_1 \Rightarrow \Phi'_1
\and 
\Phi'_2 \Rightarrow \Phi_2
\and 
\epsilon \leq \epsilon'
}
{
\prog_1 \sim_{\epsilon'} \prog_2 : 
\Phi_1 \Rightarrow \Phi_2
}~\textbf{Conseq}
\end{mathpar}
\caption{Proving Rules from apRHL}
\label{fig:aprhl}
\end{figure}
%
%
%
\clearpage
\begin{thm}[Soundness]
 $\forall \prog_1$, $\prog_2$,  $ \vdash \prog_1	
\sim_{\epsilon} 
\prog_2 :
\Phi_0 \Rightarrow \Phi $,    $\forall \trsmem_1$, $\trsmem_2$ 
s.t $\Phi_0$: 
$\trsmem_1 ~ \sem{\Phi_0} ~ \trsmem_2$,
then
$$ 
(\sem{\prog_1}_{\trsmem_1})  
\sem{\Phi}^{\#(\epsilon)} 
(\sem{\prog_2}_{\trsmem_2}) 
$$.
\end{thm}
%
%
%
\begin{proof}
By induction on the judgment $\vdash \prog_1	
\sim_{\epsilon}
\prog_2 :
\Phi_0 \Rightarrow \Phi $, we have following cases:
\begin{itemize}
\caseL{\[
\inferrule
{
	\forall \rvalL, \rvalR \in (0,1]^{\real}
}
{
	\vdash
	\varx \samplel \uniform(0, 1] 	
	\sim_{\epsilon} 
	\vary \samplel \uniform(0, 1]
	:
	\top
	\Rightarrow
	\rvalL \leq \varx^1 \langle 1 \rangle \leq \rvalR 
			\imply
	(e^{\epsilon} \rvalL \leq \vary^1 \langle 2 \rangle \leq e^{\epsilon} \rvalR
	\land \vary^1 \langle 2 \rangle \leq 1)	
}~\textbf{unif+}
\]}
	In this case, 
	assume $m_1, m_2$, $\rvalL, \rvalR \in (0,1]^{\real}$, s.t.,
	$(m_1, m_2) \in \sem{\Phi_0}$, where the precondition
	$
	\Phi_0 \triangleq
	\top
	$
	%
	is interpreted as:
	%
	\[
	\sem{\Phi_0} =
	\left \{
	(m_1, m_2)
	\right \}
	\]
	%
	%
	The post-condition $\Phi \triangleq 
		\rvalL \leq \varx^1 \langle 1 \rangle \leq \rvalR
		\imply
	e^{-\epsilon} \rvalL \leq \vary^1 \langle 2 \rangle \leq e^{\epsilon}\rvalR
	$ is interpreted as:
	%
	\[
	\sem{\Phi} =
	\left \{
	(m_1, m_2)
	~ \left \vert ~
	\rvalL \leq \sem{\varx}_{\trsmem_1}^1 \leq \rvalR
	\imply
	(e^{-\epsilon} \rvalL \leq \sem{\vary}_{\trsmem_2}^1 \leq e^{\epsilon}\rvalR
		\land \sem{\vary}_{\trsmem_2}^1 \leq 1)
	\right.
	\right \}
	\]
	%
	Let $(\fvalv_{(\rvalv_{l}, \rvalv_{u})}) = \sem{x}_{m_1}$ and 
	$(\fvalw_{(\rvalw_{l}, \rvalw_{u})}) = \sem{y}_{m_2}$, we can rewrite the interpretation of $\sem{\Phi}$ as:
	%
\[
	\sem{\Phi} =
	\left \{
	(m_1, m_2)
	~ \left \vert ~
	\begin{array}{l}
	(\fvalv_{(\rvalv_{l}, \rvalv_{u})}) = \sem{x}_{m_1}
	\land 
	(\fvalw_{(\rvalw_{l}, \rvalw_{u})}) = \sem{y}_{m_2}
	\land
	\\
	\rvalL \leq \fvalv \leq \rvalR
	\imply
	(e^{-\epsilon} \rvalL \leq 
		\fvalw \leq e^{\epsilon}\rvalR
		\land \fvalw \leq 1)
	\end{array}
	\right.
	\right \}
\]
	%
	By the semantics of sampling, we have:\\
	%
	$\sem{\varx \samplel \uniform(0, 1]}_{\trsmem_1} =
	\elet (\fvalv_{(\rvalv_{l}, \rvalv_{u})}) 
	= \sem{\uniform(0, 1]}_{\trsmem_1} 
	\ein 
	\unit{\trsmem_1[\varx \mapsto (\fvalv_{(\rvalv_{l}, \rvalv_{u})})]}
	$
	%
	\\
	%
	$\sem{\vary \samplel \uniform(0, 1]}_{\trsmem_2} = 
	\elet (\fvalw_{(\rvalw_{l}, \rvalw_{u})})
	= \sem{\uniform(0, 1]}_{\trsmem_2} 
	\ein 
	\unit{\trsmem_2[\vary \mapsto (\fvalw_{(\rvalw_{l}, \rvalw_{u})})]}
	$. \\
	%
	Then we need to prove:
	\[\mu_1(\trsmem_1) \sem{\Phi}^{\#(\epsilon)} \mu_2(\trsmem_2),\]
	where 
	$\mu_1(\trsmem) = 
	\elet (\fvalv_{(\rvalv_{l}, \rvalv_{u})}) 
	= \sem{\uniform(0, 1]}_{\trsmem} 
	\ein 
	\unit{\trsmem[\varx \mapsto (\fvalv_{(\rvalv_{l}, \rvalv_{u})})]}$ and
	%
	\\
	%
	$\mu_2(\trsmem) = 
	\elet (\fvalw_{(\rvalw_{l}, \rvalw_{u})})
	= \sem{\uniform(0, 1]}_{\trsmem} 
	\ein 
	\unit{\trsmem[\vary \mapsto (\fvalw_{(\rvalw_{l}, \rvalw_{u})})]}$.
	%
	\\
	%
	Now the following subproof is to show the subgoal:
	%
	\\
	\textbf{Subgoal:} For any pair of environments $(\trsmem_1, \trsmem_2)$, if we can show ${\muniform(0,1]} ~ R^{\#(\epsilon)} ~ {\muniform(0,1]}$, then $\mu_1(\trsmem_1) \sem{\Phi}^{\#(\epsilon)} \mu_2(\trsmem_2)$,
	%
	where
	\[
		R = 
		\left \{(\fval_1, \fval_2) \in (0,1]^\float \times (0,1]^\float 
		~|~
		\rvalL \leq \fval_1 \leq \rvalR
		\imply
		(e^{-\epsilon} \rvalL \leq \fval_2 \leq 	e^{\epsilon} \rvalR
		\land \fval_2 \leq 1)
		\right \}.
	\]
	%
	\begin{subproof}
	%
	It is equivalent to show following 3 items for any environment $\trsmem_1, \trsmem_2$:
	\\
	%
	(i) For any $\muniform(0,1]\in \distr(\float)$, there is one and only one $\edistr_1(\trsmem_1) \in \distr(Env)$.
	%
	\\
	(ii) For any $\muniform(0,1] \in \distr(\float)$, there is one and only one $\edistr_2(\trsmem_2) \in \distr(Env)$.
	\\
	%
	(iii) For any pair of float value $(\fvalv_1, \fvalv_2) \in R$ where 
	$\fvalv_1 \in \supp(\muniform(0,1])$, 
	$\fvalv_2 \in \supp(\muniform(0,1])$,
	there is one and only one pair of environments 
	$(\trsmem_1[ \varx_1 \to \fval_{1(\rval_{1l}, \rval_{1u})}], \trsmem_2[\varx_2 \to \fval_{2(\rval_{2l}, \rval_{2u})}]) \in \sem{\Phi}$
	where $\rval_{1l}, \rval_{1u}, \rval_{2l}, \rval_{2u} \in \real$.
	%
	\\ 
	%
	\textbf{Proof of (i):} 
	Given $\muniform(0,1]$, for any $\fval_1 \in \supp(\muniform(0,1])$, 
	we can always find one and only one $\fval_{1(\rval_{1l}, \rval_{1u})}$ where $\rval_{1l} = \fval_1 = \rval_{1u}$.
	%
	\\
	Then given environment $m_1$,
	we can construct one and only one $\sem{\uniform(0, 1)}_{\trsmem_1} \in \distr(\float_{\real \times \real})$
	by assigning the pdf on $\fval_{1(\rval_{1l}, \rval_{1u})}$ the same as $\pdf_{\muniform(0,1]}(\fval_1)$. 
	\\
	%
	Then we have the pdf of $\sem{\uniform(0, 1)}_{\trsmem_1}$  
	is defined as $\pdf_{\sem{\uniform(0, 1)}_{\trsmem_1}}$:
	%
	\[
	\pdf_{\sem{\uniform(0, 1)}_{\trsmem_1}}(\fval_{1(\rval_{1l}, \rval_{1u})}) = 
		\begin{cases}
		1 & \fval_1 \in (0,1]^{\mathbb{F}}
		\land  \fval_1 = \rval_{1l} = \rval_{1u}
		\\
		0       & o.w.
		\end{cases},
	\]
	Then by the Monad Law, we have the distribution:
	$\elet \fval_{1(\rval_{1l}, \rval_{1u})} = \sem{\uniform(0, 1)}_{\trsmem_1} 
	\ein \unit{\fval_{1(\rval_{1l}, \rval_{1u})}}$.
	% %
	\\
	%
	Since for any $\fval_{1(\rval_{1l}, \rval_{1u})} \in \sem{\uniform(0, 1)}_{\trsmem_1}$, 
	we can always construct one and only one environment $\trsmem_1[\varx_1 \mapsto (\fval_{1(\rval_{1l}, \rval_{1u})})]$.
	%
	\\
	Then we compose the  
	$\trsmem_1[\varx_1 \mapsto (\fval_{1(\rval_{1l}, \rval_{1u})})]$
	with $\elet \fval_{1(\rval_{1l}, \rval_{1u})} = \sem{\uniform(0, 1)}_{\trsmem_1} 
	\ein \unit{\fval_{1(\rval_{1l}, \rval_{1u})}}$ and get:
	%
	%
	$\mu_1(\trsmem_1) \in \distr(\float_{\real \times \real})$ as 
	$\elet \fval_{1(\rval_{1l}, \rval_{1u})} = \sem{\uniform(0, 1)}_{\trsmem_1} 
	\ein \unit{\trsmem_1[\varx_1 \mapsto (\fval_{1(\rval_{1l}, \rval_{1u})})]}$.
	\\
	%
	In this way, (i) are proved.
	\\
	%
	\textbf{Proof of (ii):} 
	We can also prove (ii) by repeating every steps above except substituting $\trsmem_1, \fvalv_1, \rvalv_{1l}$ and $\rvalv_{1u}$ with $\trsmem_2, \fvalv_2, \rvalv_{2l}$ and $\rvalv_{2u}$.
	%
	\\
	\textbf{Proof of (iii):} 
	Given any pair of float value $(\fvalv_1, \fvalv_2) \in R$ where 
	$\fvalv_1 \in \supp(\muniform(0,1])$, 
	$\fvalv_2 \in \supp(\muniform(0,1])$, we have by definition of $R$:
	%
	\\
	$\rvalL \leq \fvalv_1 \leq \rvalR \imply
	%
	(e^{\epsilon} \rvalL \leq \fval_2 \leq 	e^{\epsilon} \rvalR
	\land \fval_2 \leq 1)
	 ~ (3)$
	\\
	%
	By (i) and (ii), we can also construct one and only one pair of environments $\trsmem_1', \trsmem_2'$ as:
	\\
	$\trsmem_1' = \trsmem_1[\varx_1 \to \fval_{1(\rval_{1l}, \rval_{1u})}] ~ (4)$ and
	$\trsmem_2' = \trsmem_2[\varx_2 \to \fval_{2(\rval_{2l}, \rval_{2u})}] ~ (5)$,
	\\
	where $\rval_{1l} = \fval_1 = \rval_{1u}$ and $\rval_{2l} = \fval_2 = \rval_{2u}$.
	%
	\\
	In order to show $(\trsmem_1', \trsmem_2') \in \sem{\Phi}$, we need to prove:
	\\
	(a)	$(\fval_{1(\rval_{1l}, \rval_{1u})}) = \sem{x_1}_{m_1}$.
	This is proved by (5).
	\\
	(b) $(\fval_{2(\rval_{2l}, \rval_{2u})}) = \sem{x_2}_{m_2}$.
	This is proved by (6).
	\\
	(c) $\rvalL \leq \fvalv_1 \leq \rvalR \imply
	%
	(e^{\epsilon} \rvalL \leq \fval_2 \leq 	e^{\epsilon} \rvalR
	\land \fval_2 \leq 1)$.
	This is proved by (3).
	\\
	Then we have (iii) proved. 
	\end{subproof}
	%
	Since we have $\muniform(0,1] ~ R^{\#(\epsilon)} ~ \muniform(0,1]$ proved in the Theorem \ref{thm:unif+_coupling},
	%
	where 
	\[
		R = 
		\left \{(\fval_1, \fval_2) \in (0,1]^\float \times (0,1]^\float 
		~|~
		\rvalL \leq \fval_1 \leq \rvalR
		\imply
		(e^{-\epsilon} \rvalL \leq \fval_2 \leq 	e^{\epsilon} \rvalR
		\land \fval_2 \leq 1)
		\right \}.
	\]	%
	Then we have $\mu_1(\trsmem_1) \sem{\Phi}^{\#(\epsilon)} \mu_2(\trsmem_2)$ proved according to \textbf{Subgoal}.
	%
	\caseL{[\textsc{unif-}] }
	%
	The same as case [\textsc{unif+}].
		Since we have $\muniform(0,1] ~ R^{\#(\epsilon)} ~ \muniform(0,1]$ proved in the Theorem \ref{thm:unif-_coupling},
	%
	where 
	\[
		R = 
		\left \{(\fval_1, \fval_2) \in (0,1]^\float \times (0,1]^\float 
		~|~
		\rvalL \leq \fval_1 \leq \rvalR
		\imply
		e^{-\epsilon} \rvalL \leq \fval_2 \leq 	e^{-\epsilon} \rvalR
		\right \}.
	\]
	%
	Then we have $\mu_1(\trsmem_1) \sem{\Phi}^{\#(\epsilon)} \mu_2(\trsmem_2)$ proved.
	%
	\caseL{[\textsc{Null}] }
	%
	This case is obviously proved by picking the witnesses be the joint distribution of two $\muniform(0, 1)$s.
	%
	The support of witnesses are on the relation of equality.
	%
	\end{itemize}
\end{proof}
%
%
\newpage
\begin{thm}
\label{thm:unif+_coupling}
for any $\rvalL, \rvalR \in (0,1]^{\real}$, 
%
$${\muniform(0,1]} ~ R^{\#(\epsilon)} ~ {\muniform(0,1]},$$
%
where
	$	R = 
		\left \{(\fval_1, \fval_2) \in (0,1]^{\float} \times (0,1]^{\float} 
		~|~
		\rvalL \leq \fval_1 \leq \rvalR
		\imply
		(e^{\epsilon} \rvalL \leq \fval_2 \leq 	e^{\epsilon} \rvalR
		\land \fval_2 \leq 1)
		\right \}
		$.
	%
\end{thm}
%
\begin{proof}[Proof of Theorem \ref{thm:unif+_coupling}]
%
Let $\edistr_1 = \muniform(0, 1]$ and $\edistr_2 = \muniform(0, 1]$, it is equivalent to show 
${\edistr_1} ~ R^{\#(\epsilon)} ~ \edistr_2$
%
where $\edistr_1$ and $\edistr_2$ are uniform distribution over $(0, 1]$ whoes $\pdf.$ is defined as:
\[
	\pdf_{\edistr_1}(x) = 
	\begin{cases}
	1 & x \in (0, 1]^{\float} 
	%\land \fvarx = \rvarx_1 = \rvarx_2
	\\
	0       & o.w.
	\end{cases},
	~~
	\pdf_{\edistr_2}(y) = 
	\begin{cases}
	1 & y \in (0, 1]^{\float}
	% \land \fvary = \rvary_1 = \rvary_2
	\\
	0       & o.w.
	\end{cases},
\]
%
Let $R' =
		\left \{(\fval_1, \fval_2) \in (0, 1]^{\float} \times (0, 1]^{\float} 
		~|~
		(\fval_1 \in (0, e^{-\epsilon}) \imply \fval_2 =  e^{\epsilon}  \fval_1)
		\land
		(\fval_1 \in [e^{-\epsilon}, 1] \imply \fval_2 = 1 )
		\right \}$.
\\
Since this can implies $
\forall \rvalL, \rvalR \in (0,1]^{\real}. (
\rvalL \leq \fval_1 \leq \rvalR
\imply
(e^{\epsilon} \rvalL \leq \fval_2 \leq 	e^{\epsilon} \rvalR \land \fval_2 \leq 1))$,
 we have $R' \implies R$.
%
\\
Then, we know ${\edistr_1} ~ {R'}^{\#(\epsilon)} ~ \edistr_2
\implies {\edistr_1} ~ R^{\#(\epsilon)} ~ \edistr_2$.
% \\
Then, it is enough to show ${\edistr_1} ~ {R'}^{\#(\epsilon)} ~ \edistr_2$.
%
\\
%
Let $\mu_L, \mu_R \in \distr((0,1]^{\float} \times (0,1]^{\float})$ 
be the two witness distribution s.t.
% \[
% 	{\mu_L}(x, y) = 
% 	\begin{cases}
% 	\edistr_1(\varx)
% 	& x  = y \cdot e^{-\epsilon} \land x \in (0, e^{-\epsilon}]\\
% 	\muniform()
% 	0       & o.w.
% 	\end{cases},
% ~~~
% 	{\mu_R}(x, y) = 
% 	\begin{cases}
% 	\edistr_2(y)
% 	& x  = y \cdot e^{-\epsilon} \land y \in (0, 1]\\
% 	0       & o.w.
% 	\end{cases},
% \]
% %
% %
% and 
their $\pdf.$ are defined as:
\[
	\pdf_{\mu_L}(x, y) = 
	\begin{cases}
	\pdf_{\edistr_1}(y) & x = y \cdot e^{-\epsilon} \land x \in (0, e^{-\epsilon})\\
	1 		& x \in [e^{-\epsilon}, 1] \land y = 1\\
	0       & o.w.
	\end{cases},
~~~
	\pdf_{\mu_R}(x, y) = 
	\begin{cases}
	\pdf_{\edistr_2}(x) 		& x = y \cdot e^{-\epsilon} \land y \in (0, 1)\\
	\frac{1}{1 - e^{-\epsilon}}& x \in [e^{-\epsilon}, 1] \land y = 1\\
	0       & o.w.
	\end{cases}.
\]
It is enough to show the 2 witnesses $\edistr_L(x, y)$ and $\edistr_R(x, y)$ are satisfying following three requirements:
\begin{itemize}
	\item $\supp(\mu_L) \in R' \land \supp(\mu_R) \in R'$

	\begin{itemize}
		\item $\supp(\mu_L) \subseteq R'$ 
		%
		\\
		% 
		By definition of the $\pdf$ of $\mu_L$, 
		$\forall \pdf_{\mu_R}(x, y) > 0$,
		we have: 
		\\
		$x = y \cdot e^{-\epsilon} \land x \in (0, e^{-\epsilon})\in R'$ 
		and 
		$x \in [e^{-\epsilon}, 1] \land y = 1 \in R'$
		%
		\\%
		%
		Then we can derive $\supp(\mu_L) \in R'$
		%
		\item $\supp(\mu_R) \subseteq R'$
		%
		\\
		%
		By definition of the $\pdf$ of $\mu_L$, 
		$\forall \pdf_{\mu_L}(x, y) > 0$,
		we have
		\\
		$x = y \cdot e^{-\epsilon} \land y \in (0, 1)\in R'$ 
		and 
		$x \in [e^{-\epsilon}, 1] \land y = 1 \in R'$
		%
		\\
		%
		Then we can derive $\supp(\mu_L) \in R'$
		%
	\end{itemize}		
%
	\item $\projl(\mu_L) = \mu_1 \land \projr(\mu_R) = \mu_2$
	
	\begin{itemize}
		\item $\projl(\mu_L) = \mu_1$ 

		% Equivalent to show $\pdf_{\projl(\mu_L)}  = \pdf_{\mu_1}$.

		By definition of the $\projl$ and $\pdf$ of $\mu_L$, we have $\forall x  \in \float$:
		\[
			\pdf_{\projl(\mu_L)}(x) = 
			\begin{cases}
			\int_{y}\pdf_{\uniform}(y) 
			& x = y \cdot e^{-\epsilon}  \land x \in (0, e^{-\epsilon})\\
			\int_{y} 1 & x \in [e^{-\epsilon}, 1] \land y = 1\\
			0       & o.w.
			\end{cases} 
			= 
			\begin{cases}
			1
			&  x \in (0, e^{-\epsilon})\\
			1 & x \in [e^{-\epsilon}, 1] \\
			0       & o.w.
			\end{cases}
			=
			\pdf_{\mu_1}(x)
		\]

		\item $\projr(\mu_R) = \mu_2$ 

		Equivalent to show$\pdf_{\projr(\mu_R)}  = \pdf_{\mu_2}$.

		By definition of the $\projr$ and $\pdf$ of $\mu_R$, we have $\forall y \in \float$:
		\[
			\pdf_{\projr(\mu_R)}(y) = 
			\begin{cases}
			\int_{x}\pdf_{\uniform}(x) 
			& x = y \cdot e^{-\epsilon} \land y \in (0, 1)\\
			\int_{x} \frac{1}{1 - e^{-\epsilon}} 
			& x \in [e^{-\epsilon}, 1] \land y = 1\\
			0       & o.w.
			\end{cases} 
			= 
			\begin{cases}
			1 & y \in (0, 1)\\
			1 & y = 1\\
			0       & o.w.
			\end{cases}
			=
			\pdf_{\mu_2}(y)
		\]
	\end{itemize}	

	\item $\Delta_{\epsilon}(\mu_L, \mu_R) \leq 0$

	By definition of $\epsilon-$DP divergence, we have:
	 \[
	 \begin{array}{ll}
	 \Delta_{\epsilon}(\mu_L, \mu_R) 
	 & = \underset{S}{\psup}
	 \Big(
	 \pr{(x,y) \samplel \mu_L}{(x,y) \in S} - e^{\epsilon} \pr{(x,y) \samplel \mu_R}{(x,y) \in S}
	 \Big) \\
	 & =\underset{S}{\psup}
	 \Big(
	 \int_{(x,y) \in S} \pdf_{\mu_L}(x, y) - e^{\epsilon} \int_{(x,y) \in S} \pdf_{\mu_R}(x, y)
	 \Big)	 
	 \end{array}
	 \]
	 \begin{itemize}
	 	\item[{\bf case}]
	 	%
	 	$S \subseteq \{(x, y) ~|~ 
	 	x = y \cdot e^{-\epsilon}  \land x \in (0, e^{-\epsilon}) \}$:
	 	%
		\[
		 \begin{array}{ll}
		 \Delta_{\epsilon}(\mu_L, \mu_R) 
		 & = 
		 \int_{(x,y) \in S} \pdf_{\uniform}(y) - e^{\epsilon} \int_{(x,y) \in S} \pdf_{\uniform}(x)\\
		 & = 
		 \int_{(x,y) \in S} 1 - e^{\epsilon} \int_{(x,y) \in S} 1\\ 
		 & = 
		 (1 - e^{\epsilon})\int_{(x,y) \in S} 1
		 \leq 0 
		 \end{array}
		 \]
		 %
	 	\item[{\bf case}] $S \subseteq \{(x, y) 
	 	~|~ x \in [e^{-\epsilon}, 1] \land y = 1 \}$:
	 	%
		 \[
		 \Delta_{\epsilon}(\mu_L, \mu_R) 
		 = 
		 \int_{(x,y) \in S} 1 - e^{\epsilon} \int_{(x,y) \in S} \frac{1}{1 - e^{-\epsilon}}
		   = (1 - e^{\epsilon}) \leq 0
		 \]
	 	\item[{\bf case}] o.w.:
	 	%
		 \[
		 \Delta_{\epsilon}(\mu_L, \mu_R) = 0 - 0 =  0 
		 \]	 	

	 \end{itemize}

\end{itemize}
\end{proof}
%
%
\begin{thm}
\label{thm:unif-_coupling}
for any $\rvalL, \rvalR \in (0,1]^{\real}$, 
%
$${\muniform(0,1]} ~ R^{\#(\epsilon)} ~ {\muniform(0,1]},$$
%
where
	$	R = 
		\left \{(\fval_1, \fval_2) \in {\float} \times {\float} 
		~|~
		\rvalL \leq \fval_1 \leq \rvalR
		\imply
		e^{-\epsilon} \rvalL \leq \fval_2 \leq 	e^{-\epsilon} \rvalR
		\right \}
		$.
	%
\end{thm}
%
\begin{proof}[Proof of Theorem \ref{thm:unif-_coupling}]
%
Let $\edistr_1 = \muniform(0, 1]$ and $\edistr_2 = \muniform(0, 1]$, it is equivalent to show 
${\edistr_1} ~ R^{\#(\epsilon)} ~ \edistr_2$
%
where $\edistr_1$ and $\edistr_2$ are uniform distribution over $(0, 1]$ whoes $\pdf.$ is defined as:
\[
	\pdf_{\edistr_1}(x) = 
	\begin{cases}
	1 & x \in [0, 1)^{\mathbb{F}} 
	%\land \fvarx = \rvarx_1 = \rvarx_2
	\\
	0       & o.w.
	\end{cases},
	~~
	\pdf_{\edistr_2}(y) = 
	\begin{cases}
	1 & y \in [0, 1)^{\mathbb{F}}
	% \land \fvary = \rvary_1 = \rvary_2
	\\
	0       & o.w.
	\end{cases},
\]
%
Let $R' =
		\left \{(\fval_1, \fval_2) \in {\float} \times {\float} 
		~|~
		\fval_2 =  e^{-\epsilon}  \fval_1
		\right \}$.
\\
Since $\fval_2 = e^{-\epsilon} \fval_1 \implies 
\forall \rvalL, \rvalR \in (0,1]^{\real}. (
\rvalL \leq \fval_1 \leq \rvalR
\imply
e^{-\epsilon} \rvalL \leq \fval_2 \leq 	e^{-\epsilon} \rvalR)$,
 we have $R' \implies R$.
%
\\
Then, we know ${\edistr_1} ~ {R'}^{\#(\epsilon)} ~ \edistr_2
\implies {\edistr_1} ~ R^{\#(\epsilon)} ~ \edistr_2$.
% \\
Then, it is enough to show ${\edistr_1} ~ {R'}^{\#(\epsilon)} ~ \edistr_2$.
%
\\
%
Let $\mu_L, \mu_R \in \distr(\float \times \float)$ 
be the two witness distribution s.t.:
\[
	{\mu_L}(x, y) = 
	\begin{cases}
	\edistr_1(\varx)
	& x \cdot e^{-\epsilon} = y  \land x \in (0, 1]\\
	0       & o.w.
	\end{cases},
~~~
	{\mu_R}(x, y) = 
	\begin{cases}
	\edistr_2(y)
	& x \cdot e^{-\epsilon} = y \land y \in (0, 1]\\
	0       & o.w.
	\end{cases},
\]
%
%
and their $\pdf.$ are defined as:
\[
	\pdf_{\mu_L}(x, y) = 
	\begin{cases}
	\pdf_{\edistr_1}(x) & x \cdot e^{-\epsilon} = y  \land x \in [0, 1)\\
	0       & o.w.
	\end{cases},
~~~
	\pdf_{\mu_R}(x, y) = 
	\begin{cases}
	\pdf_{\edistr_2}(y) & x \cdot e^{-\epsilon} = y  \land y \in [0, 1)\\
	0       & o.w.
	\end{cases}.
\]
It is enough to show the 2 witnesses $\edistr_L(x, y)$ and $\edistr_R(x, y)$ are satisfying following three requirements:
\begin{itemize}
	\item $\supp(\mu_L) \in R' \land \supp(\mu_R) \in R'$

	\begin{itemize}
		\item $\supp(\mu_L) \subseteq R'$ 
		%
		\\
		% 
		By definition of the $\pdf$ of $\mu_L$, 
		$\forall \pdf_{\mu_R}(x, y) > 0$,
		we have 
		$x \cdot e^{-\epsilon} = y  \in R'$ 
		%
		\\%
		%
		Then we can derive $\supp(\mu_L) \in R'$
		%
		\item $\supp(\mu_R) \subseteq R'$
		%
		\\
		%
		By definition of the $\pdf$ of $\mu_L$, 
		$\forall \pdf_{\mu_L}(x, y) > 0$,
		we have
		$x \cdot e^{-\epsilon} = y \in R'$ 
		%
		\\
		%
		Then we can derive $\supp(\mu_L) \in R'$
		%
	\end{itemize}		
%
	\item $\projl(\mu_L) = \mu_1 \land \projr(\mu_R) = \mu_2$
	
	\begin{itemize}
		\item $\projl(\mu_L) = \mu_1$ 

		% Equivalent to show $\pdf_{\projl(\mu_L)}  = \pdf_{\mu_1}$.

		By definition of the $\projl$ and $\pdf$ of $\mu_L$, we have $\forall x  \in \float$:
		\[
			\pdf_{\projl(\mu_L)}(x) = 
			\begin{cases}
			\int_{y}\pdf_{\uniform}(x) 
			& x \cdot e^{-\epsilon}  = y 
			\land x \in [0, 1)\\
			0       & o.w.
			\end{cases} 
			= 
			\begin{cases}
			\pdf_{\uniform}(x) & \fvarx \in [0, 1)\\
			0       & o.w.
			\end{cases}
			=
			\pdf_{\mu_1}(x)
		\]

		\item $\projr(\mu_R) = \mu_2$ 

		Equivalent to show$\pdf_{\projr(\mu_R)}  = \pdf_{\mu_2}$.

		By definition of the $\projr$ and $\pdf$ of $\mu_R$, we have $\forall y \in \float$:
		\[
			\pdf_{\projr(\mu_R)}(y) = 
			\begin{cases}
			\int_{x}\pdf_{\uniform}(y) 
			& x \cdot e^{-\epsilon} = y 
			\land y \in (0, 1]\\
			0       & o.w.
			\end{cases} 
			= 
			\begin{cases}
			\pdf_{\uniform}(y) & y \in (0, 1]\\
			0       & o.w.
			\end{cases}
			=
			\pdf_{\mu_2}(y)
		\]
	\end{itemize}	

	\item $\Delta_{\epsilon}(\mu_L, \mu_R) \leq 0$

	By definition of $\epsilon-$DP divergence, we have:
	 \[
	 \begin{array}{ll}
	 \Delta_{\epsilon}(\mu_L, \mu_R) 
	 & = \underset{S}{\psup}
	 \Big(
	 \pr{(x,y) \samplel \mu_L}{(x,y) \in S} - e^{\epsilon} \pr{(x,y) \samplel \mu_R}{(x,y) \in S}
	 \Big) \\
	 & =\underset{S}{\psup}
	 \Big(
	 \int_{(x,y) \in S} \pdf_{\mu_L}(x, y) - e^{\epsilon} \int_{(x,y) \in S} \pdf_{\mu_R}(x, y)
	 \Big)	 
	 \end{array}
	 \]
	 \begin{itemize}
	 	\item[{\bf case}]
	 	%
	 	$S \subseteq \{(x, y) ~|~ 
	 	x \in (0, 1] \land x \cdot e^{-\epsilon} = y \}$:
	 	%
		\[
		 \begin{array}{ll}
		 \Delta_{\epsilon}(\mu_L, \mu_R) 
		 & = 
		 \int_{(x,y) \in S} \pdf_{\uniform}(x) - e^{\epsilon} \int_{(x,y) \in S} \pdf_{\uniform}(y)\\
		 & = 
		 \int_{(x,y) \in S} \pdf_{\uniform}(x) - e^{\epsilon} \int_{(x,y) \in S} \pdf_{\uniform}(x * e^{-\epsilon})\\ 
		 & = 
		 \int_{(x,y) \in S} \pdf_{\uniform}(x) - e^{\epsilon}* e^{-\epsilon} \int_{(x,y) \in S} \pdf_{\uniform}(x) 
		 = 0 
		 \end{array}
		 \]
		 %
	 	\item[{\bf case}] $S \subseteq \{(x, y) 
	 	~|~ x \in [1, e^{\epsilon}) 
	 	\land x \cdot e^{-\epsilon} = y \}$:
	 	%
		 \[
		 \Delta_{\epsilon}(\mu_L, \mu_R) 
		 = 
		 0 - e^{\epsilon} \int_{(x,y) \in S} \pdf_{\uniform}(y) <0
		 \]
	 	\item[{\bf case}] o.w.:
	 	%
		 \[
		 \Delta_{\epsilon}(\mu_L, \mu_R) = 0 - 0 =  0 
		 \]	 	

	 \end{itemize}

\end{itemize}
\end{proof}
%
\newpage
\section{Snapping Mechanism}

\begin{defn}
[$\snap(a) : A \to \distr(\real)$]
Given privacy parameter $\epsilon$, the Snapping mechanism $\snap(a)$ is defined as:
\[
	\varu \samplel \uniform(0,1); s \samplel \uniform\{-1, 1\};
	\varx = f(a) + \frac{1}{\epsilon} \times s \times \ln (\varu);
	\vary = \round{\varx}_{\Lambda};
	\varz = \clamp_B (\vary)
\]
where $f(a)$ represents a value that the query function $f$ be evaluated over input database $a \in A$, $\epsilon$ is the privacy parameter, $B$ is the clamping argument and $\Lambda$ is the rounding argument satisfying $\lambda = 2^k$ where $2^k$ is the smallest power of 2 greater or equal to the $\frac{1}{\epsilon}$.
\end{defn}
%
\begin{thm}[The $\snap$ mechanism is 
$\epsilon-$differentially private]
\end{thm}
\begin{proof}
Induction on the output space of $\snap(a)$ mechanism, let $\valv$ be the output of $\snap(a)$, we have following cases:
Let $a, a'$ be adjacent data base where $f(a) = f(a') + 1$
\begin{itemize}
	\caseL{$\boldsymbol{\varz = -B}$}
%
Let $b$ be the largest number rounded by $\Lambda$ that is smaller than $B$, $b' = b + \Lambda / 2$.
%
\\
Let $\rvalL_1 = \rvalL_2 = 0$, 
$\rvalR_1 = e^{\epsilon 
		(-(b + \Lambda / 2)(1 + \eta)^3 - f(a))(1 + \eta)^2}$
and $\rvalR_2 = e^{\epsilon 
		(-(b + \Lambda / 2)(1 + \eta) - f(a'))(1 + \eta)^2}$.
		\\
Then we have following derivation for this case:

{\tiny
\begin{mathpar}
\inferrule
{
	\inferrule
	{
	\inferrule
	{
		\inferrule
		{
			\forall \rvalL, \rvalR \in (0, 1]
		}
		{	\varu_1 \samplel \uniform(0,1)
			\sim_{\epsilon(1 + \eta)^2} 
			\varu_2 \samplel \uniform(0,1)
			: 
			f(a) = f(a') + 1
			\Rightarrow 
			\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
			e^{\epsilon(1 + \eta)^2} \rvalL \leq u^1_2\langle 2 \rangle \leq e^{\epsilon(1 + \eta)^2}\rvalR
		}~\textbf{Unif+}
		\\ 
		f(a) = f(a') + 1 \Rightarrow f(a) = f(a') + 1
		\and
		\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
		\Big(e^{\epsilon(1 + \eta)^2}\rvalL \leq u^1_2\langle 2 \rangle \leq e^{\epsilon(1 + \eta)^2}\rvalR \Big)
		\Rightarrow
		\Phi
	}
	{
		\varu_1 \samplel \uniform(0,1)
		\sim_{\epsilon(1 + \eta)^2} 
		\varu_2 \samplel \uniform(0,1)
		: 
		f(a) = f(a') + 1
		\Rightarrow 
		\Phi
	}~\textbf{Conseq}
	\and
	\inferrule
	{
	\empty
	}
	{
		s_1 = \samplel \uniform\{-1, 1\}
		\sim_{0} 
		s_2 = \samplel \uniform\{-1, 1\}
		: 
		\Phi
		\\\\
		\Rightarrow 
		\Phi \land s_1^1 \langle 1 \rangle
		= s_2^1\langle 2 \rangle
	}~\textbf{Null}
	}
	{
		\varu_1 \samplel \uniform(0,1); s_1 = \samplel \uniform\{-1, 1\}
		\sim_{\epsilon(\eta + 1)^2} 
		\varu_2 \samplel \uniform(0,1); s_2 = \samplel \uniform\{-1, 1\}
		: 
		f(a) = f(a') + 1 \Rightarrow \Phi \land s_1\langle 1 \rangle) 
		= s_2\langle 2 \rangle)
	}~\textbf{Seq}
\\
\Pi_R
}
{
	\vdash 
	\varu_1 \samplel \uniform(0,1); s_1 = \samplel \uniform\{-1, 1\};
	\varx_1 = f(a) + \frac{1}{\epsilon} \times s_1 \times \ln (\varu_1);
	\vary_1 = \round{\varx_1}_{\Lambda};
	\varz_1 = \clamp_B (\vary_1)
	\\
	\sim_{\epsilon(\eta + 1)^2} 
	\varu_2 \samplel \uniform(0,1); s_2 = \samplel \uniform\{-1, 1\};
	\varx_2 = f(a') + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_2)
	\vary_2 = \round{\varx_2}_{\Lambda};
	\varz_2 = \clamp_B (\vary_2)
	: 
	f(a) = f(a') + 1
	\Rightarrow 
	\varz_1\langle 1 \rangle = -B \imply \varz_2\langle 2 \rangle = -B
}~\textbf{Seq}
\\
\Pi_R:
\\
\inferrule
{
\inferrule
{	
	\Phi \Rightarrow \Phi
	\and
	\inferrule
	{
		\empty
	}
	{
		\varx_1 = 
		f(a) + \frac{1}{\epsilon} \times s_1 \times \ln (\varu_1)
		\sim_{0} 
		\varx_2 =
		f(a') + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_2)
		:
		\Phi \land s^1_1\langle 1 \rangle = s^1_2\langle 2 \rangle)
		\Rightarrow
		\Phi'
	}~\textbf{Assn}
	\and
	\Phi' \Rightarrow  0 < \Big(\varx_1\langle 1 \rangle\Big)^1 < -(b + \frac{\Lambda}{2} )
		\imply 
		0 < \Big(\varx_2\langle 2 \rangle \Big)^1 < -(b + \frac{\Lambda}{2} )
}
{
	\varx_1 = f(a) + \frac{1}{\epsilon} \times s_1 \times \ln (\varu_1)
	\sim_{0} 
	\varx_2 = f(a') + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_2)
	:
	\Phi 
	\land s^1_1\langle 1 \rangle = s^1_2\langle 2 \rangle
	\Rightarrow 
	0 < \Big(\varx_1\langle 1 \rangle\Big)^1 < - (b + \frac{\Lambda}{2} )
		\imply 
		0 < \Big(\varx_2\langle 2 \rangle \Big)^1 < - (b + \frac{\Lambda}{2})
}~\textbf{Conseq}
\and
\Delta_R
}
{
	\varx_1 = f(a) + \frac{1}{\epsilon} \times s_1 \times \ln (\varu_1);
	\vary_1 = \round{\varx_1}_{\Lambda};
	\varz_1 = \clamp_B(\vary_1)
	\sim_{0} 
	\varx_2 = f(a') + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_2);
	\vary_2 = \round{\varx_2}_{\Lambda};
	\varz_2 = \clamp_B(\vary_2)
	:
	f(a) = f(a') + 1 \land \Phi \land s_1\langle 1 \rangle) = s_2\langle 2 \rangle)
	\Rightarrow 
	\varz^1_1\langle 1 \rangle = -B
	\imply  = \varz_2^1\langle 2 \rangle) = -B
}~\textbf{Seq}
\\
\Delta_R:
\\
\inferrule
{
	\inferrule
	{
		\empty
	}
	{
		\vary_1 = \round{\varx_1}_{\Lambda}
		\sim_{0}
		\vary_2 = \round{\varx_2}_{\Lambda}
		: 
				0 < \Big(\varx_1\langle 1 \rangle\Big)^1 < - (b + \frac{\Lambda}{2} )
		\imply 
		0 < \Big(\varx_2\langle 2 \rangle \Big)^1 < - (b + \frac{\Lambda}{2})
		\\\\
		\Rightarrow 
		\vary^1_1\langle 1 \rangle < - (b + \Lambda) 
		\imply 
		\vary^1_2\langle 2 \rangle < - (b + \Lambda) 
	}~\textbf{Round}
	\and
	\inferrule
	{
		\empty
	}
	{
		\varz_1 = \clamp_B(\vary_1)
		\sim_{0}
		\varz_2 = \clamp_B(\vary_2)
		: 
		\vary^1_1\langle 1 \rangle < - (b + \Lambda) 
		\imply 
		\vary^1_2\langle 2 \rangle < - (b + \Lambda)
		\\\\  
		\Rightarrow 
			\varz^1_1\langle 1 \rangle = -B
	\imply  = \varz_2^1\langle 2 \rangle = -B
	}~\textbf{Null}
}
{
	\vary_1 = \round{\varx_1}_{\Lambda};
	\varz_1 = \clamp_B(\vary_1)
	\sim_{0} 
	\vary_2 = \round{\varx_2}_{\Lambda};
	\varz_2 = \clamp_B(\vary_2)
	:
		0 < \Big(\varx_1\langle 1 \rangle\Big)^1 < - (b + \frac{\Lambda}{2} )
		\imply 
		0 < \Big(\varx_2\langle 2 \rangle \Big)^1 < - (b + \frac{\Lambda}{2})
	\Rightarrow 
	\varz^1_1\langle 1 \rangle = -B
	\imply  = \varz_2^1\langle 2 \rangle = -B
}
\end{mathpar}
}
%
The assertion in the derivation is defined as:
\\
$\Phi \triangleq \rvalL_1 < 
u^1_1\langle 1 \rangle < \rvalR_1 \imply 
		\rvalL_2 < u^1_2\langle 2 \rangle < \rvalR_2$
\\
$\Phi' \triangleq 
\Phi[\varx_1/f(a) + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_1), \varx_2/f(a') + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_2)] $
%
\\
The $\Phi' \Rightarrow  0 < \Big(\varx_1\langle 1 \rangle\Big)^1 < -(b + \frac{\Lambda}{2} )
		\imply 
		0 < \Big(\varx_2\langle 2 \rangle \Big)^1 < -(b + \frac{\Lambda}{2} ) $ 
is proved as following:
%
\begin{subproof}
By the interpretation of assertion, we have $\sem{\Phi'}$:
\[
	\sem{\Phi'} \triangleq
	\left\{
	(\trsmem_1, \trsmem_2)
	\left \vert 
	0 < \sem{u_1}_{\trsmem_1} < \rvalR_1
	\imply
	0 < \sem{u_2}_{\trsmem_2} < \rvalR_2
	\right. \right\}
	\left[
	\varx_1/f(a) + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_1), \varx_2/f(a') + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_2) 
	\right]
\]

By the program semantics, we have the runtime environment $\trsmem_1, \trsmem_2$ as:
\\
{\tiny
\[
\begin{array}{ll}
	& \sem{\varu_1 \samplel \uniform(0,1); s_1 = \samplel \uniform\{-1, 1\};
		\varx_1 = f(a) + \frac{1}{\epsilon} \times s_1 \times \ln (\varu_1)}_{[]} =
	\\
	&
	 \elet (\fval_1, \rval_1, \rval_1 ) = \sem{\uniform(0,1)}_{[]} 
	 \ein \elet (1, 1, 1) = \sem{\uniform\{-1, 1\}} \ein
	 [\varu_1 \mapsto (\fval_1, \rval_1, \rval_1); 
	 s_1 \mapsto (1, 1, 1); 
	 \varx_1 \mapsto \bigg(
				f(a) + \frac{1}{\epsilon} \times \ln(u^1_1),
				%
				 (f(a) + 
				(\frac{1}{\epsilon} \times \ln(u^2_1))
				(1 + \eta)^2)
				{(1 + \eta)},
				%
				\frac{(
				f(a) + \frac{\frac{1}{\epsilon} 
				\times \ln(u^3_1)}
				{(1 + \eta)^2}
				)}
				{(1 + \eta)}
				\bigg)]
	\\
	\sim
	&
	\sem{\varu_2 \samplel \uniform(0,1); s_2 = \samplel \uniform\{-1, 1\};
		\varx_2 = f(a') + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_2)}
	\\
	&
	\elet (\fval_2, \rval_2, \rval_2) = \sem{\uniform(0,1)}_{[]}
	\ein \elet (1, 1, 1) = \sem{\uniform\{-1, 1\}} \ein
	[\varu_2 \mapsto (\fval_2, \rval_2, \rval_2);
	 s_2 \mapsto (1, 1, 1); 
	 \varx_2 \mapsto \bigg(
				f(a) + \frac{1}{\epsilon} \times \ln(u^1_2),
						%
				\big( (f(a') + 
				(\frac{1}{\epsilon} \times \ln(u^2_2))
				(1 + \eta)^2)
				{(1 + \eta)},
				%
				\frac{(
				f(a') + \frac{\frac{1}{\epsilon} 
				\times \ln(u^3_2)}
				{(1 + \eta)^2}
				)}
				{(1 + \eta)}
				 \big)
				\bigg)]	
	\end{array}
\]
}
%
 We also have $\varu^1_1 = \varu^2_1 = \varu^3_1$, 
	$\varu^1_2 = \varu^2_2 = \varu^3_2$,
	$\varx^2_1 \leq \varx^1_1 \leq \varx^3_1$ and 
	$\varx^2_2 \leq \varx^1_2 \leq \varx^3_2$ by the semantics, 
	then we can get:
{\tiny
\[
\begin{array}{rcl}
	(f(a) + (\frac{1}{\epsilon} \times \ln(\rvalL_1))
	(1 + \eta)^2){(1 + \eta)}
	< \varx^1_1 < 
	\frac{(f(a) + \frac{\frac{1}{\epsilon} 
	\times \ln(\rvalR_1)}{(1 + \eta)^2})}{(1 + \eta)}
	& \imply &
	(f(a') + (\frac{1}{\epsilon} \times \ln(\rvalL_2))
	(1 + \eta)^2){(1 + \eta)} 
	< \varx^1_2 < 
	\frac{(f(a') + \frac{\frac{1}{\epsilon} 
	\times \ln(\rvalR_2)}{(1 + \eta)^2})}{(1 + \eta)}
	\\
	0 < \varx^1_1 <  b + \frac{\Lambda}{2}
	& \imply &
	0 < \varx^1_2 < b + \frac{\Lambda}{2}
	\end{array}
\]
}
Then, we have $\Phi' \Rightarrow  0 < \Big(\varx_1\langle 1 \rangle\Big)^1 < -(b + \frac{\Lambda}{2} )
		\imply 
		0 < \Big(\varx_2\langle 2 \rangle \Big)^1 < -(b + \frac{\Lambda}{2} ) $  proved.
\end{subproof}
%
%
\caseL{
	$\boldsymbol{\valv \in (-B, \round{f(a')}_{\Lambda})} ~ (\star) $
	}
	%
	\subcaseL{
	$\boldsymbol{\round{f(a')}_{\Lambda} \leq 0 
	\lor \bigg( \round{f(a')}_{\Lambda} > 0 \land \valv \in (-B, 0) \bigg) } ~ (\star_1)$
	}
	%
	Let $\valv_1 = \valv - (\frac{\Lambda}{2})$,
		$\valv_2 = \valv + (\frac{\Lambda}{2})$, 
		we know $\valv_1 < 0$, $\valv_2 < 0$.
\\
Let $\rvalL_1 = e^{\epsilon
		(\frac{(\frac{\valv_1}{1 + \eta} - f(a))}{(1 + \eta)^2})}$,
$\rvalL_2 = e^{\epsilon
		(\frac{(\frac{\valv_1}{1 + \eta} - f(a'))}{(1 + \eta)^2})}$, 
$\rvalR_1 = e^{\epsilon
				\big( (\valv_2(1 + \eta) - f(a)) (1 + \eta)^2) \big)}$
and $\rvalR_2 = e^{\epsilon
				\big( (\valv_2(1 + \eta) - f(a')) (1 + \eta)^2) \big)}$.
\\
Then, we have following derivation for this case:
%
{\tiny
\begin{mathpar}
\inferrule
{
	\inferrule
	{
	\inferrule
	{
		\inferrule
		{
			\forall \rvalL, \rvalR \in (0, 1]
		}
		{	\varu_1 \samplel \uniform(0,1)
			\sim_{\epsilon/(1 + \eta)^2} 
			\varu_2 \samplel \uniform(0,1)
			: 
			f(a) = f(a') + 1
			\Rightarrow 
			\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
			e^{\epsilon(1 + \eta)^2} \rvalL \leq u^1_2\langle 2 \rangle \leq e^{\epsilon(1 + \eta)^2}\rvalR
		}~\textbf{Unif+}
		\\ 
		f(a) = f(a') + 1 \Rightarrow f(a) = f(a') + 1
		\and
		\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
		\Big(e^{\epsilon/(1 + \eta)^2}\rvalL \leq u^1_2\langle 2 \rangle \leq e^{\epsilon/(1 + \eta)^2}\rvalR \Big)
		\Rightarrow
		\Phi
	}
	{
		\varu_1 \samplel \uniform(0,1)
		\sim_{\epsilon/(1 + \eta)^2} 
		\varu_2 \samplel \uniform(0,1)
		: 
		f(a) = f(a') + 1
		\Rightarrow 
		\Phi
	}~\textbf{Conseq}
	\and
	\inferrule
	{
	\empty
	}
	{
		s_1 = \samplel \uniform\{-1, 1\}
		\sim_{0} 
		s_2 = \samplel \uniform\{-1, 1\}
		: 
		\Phi
		\\\\
		\Rightarrow 
		\Phi \land s_1^1 \langle 1 \rangle
		= s_2^1\langle 2 \rangle
	}~\textbf{Null}
	}
	{
		\varu_1 \samplel \uniform(0,1); s_1 = \samplel \uniform\{-1, 1\}
		\sim_{\epsilon/(\eta + 1)^2} 
		\varu_2 \samplel \uniform(0,1); s_2 = \samplel \uniform\{-1, 1\}
		: 
		f(a) = f(a') + 1 \Rightarrow \Phi \land s_1\langle 1 \rangle) 
		= s_2\langle 2 \rangle)
	}~\textbf{Seq}
\\
\Pi_R
}
{
	\vdash 
	\varu_1 \samplel \uniform(0,1); s_1 = \samplel \uniform\{-1, 1\};
	\varx_1 = f(a) + \frac{1}{\epsilon} \times s_1 \times \ln (\varu_1);
	\vary_1 = \round{\varx_1}_{\Lambda};
	\varz_1 = \clamp_B (\vary_1)
	\\
	\sim_{\epsilon/(\eta + 1)^2} 
	\varu_2 \samplel \uniform(0,1); s_2 = \samplel \uniform\{-1, 1\};
	\varx_2 = f(a') + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_2)
	\vary_2 = \round{\varx_2}_{\Lambda};
	\varz_2 = \clamp_B (\vary_2)
	: 
	f(a) = f(a') + 1
	\Rightarrow 
	\varz_1\langle 1 \rangle = v \imply \varz_2\langle 2 \rangle = v
}~\textbf{Seq}
\\
\Pi_R:
\\
\inferrule
{
\inferrule
{	
	\Phi \Rightarrow \Phi
	\and
	\inferrule
	{
		\empty
	}
	{
		\varx_1 = 
		f(a) + \frac{1}{\epsilon} \times s_1 \times \ln (\varu_1)
		\sim_{0} 
		\varx_2 =
		f(a') + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_2)
		:
		\Phi \land s^1_1\langle 1 \rangle = s^1_2\langle 2 \rangle)
		\Rightarrow
		\Phi'
	}~\textbf{Assn}
	\and
	\Phi' \Rightarrow  v_1 < \Big(\varx_1\langle 1 \rangle\Big)^1 < v_2
		\imply 
		v_1 < \Big(\varx_2\langle 2 \rangle \Big)^1 < v_2
}
{
	\varx_1 = f(a) + \frac{1}{\epsilon} \times s_1 \times \ln (\varu_1)
	\sim_{0} 
	\varx_2 = f(a') + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_2)
	:
	\Phi 
	\land s^1_1\langle 1 \rangle = s^1_2\langle 2 \rangle
	\Rightarrow 
	v_1 < \Big(\varx_1\langle 1 \rangle\Big)^1 < v_2
		\imply 
		v_1 < \Big(\varx_2\langle 2 \rangle \Big)^1 < v_2
}~\textbf{Conseq}
\and
\Delta_R
}
{
	\varx_1 = f(a) + \frac{1}{\epsilon} \times s_1 \times \ln (\varu_1);
	\vary_1 = \round{\varx_1}_{\Lambda};
	\varz_1 = \clamp_B(\vary_1)
	\sim_{0} 
	\varx_2 = f(a') + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_2);
	\vary_2 = \round{\varx_2}_{\Lambda};
	\varz_2 = \clamp_B(\vary_2)
	:
	f(a) = f(a') + 1 \land \Phi \land s_1\langle 1 \rangle) = s_2\langle 2 \rangle)
	\Rightarrow 
	\varz^1_1\langle 1 \rangle = v
	\imply  = \varz_2^1\langle 2 \rangle) = v
}~\textbf{Seq}
\\
\Delta_R:
\\
\inferrule
{
	\inferrule
	{
		\empty
	}
	{
		\vary_1 = \round{\varx_1}_{\Lambda}
		\sim_{0}
		\vary_2 = \round{\varx_2}_{\Lambda}
		: 
				v_1 < \Big(\varx_1\langle 1 \rangle\Big)^1 < v_2
		\imply 
		v_1 < \Big(\varx_2\langle 2 \rangle \Big)^1 < v_2
		\\\\
		\Rightarrow 
		\vary^1_1\langle 1 \rangle = v 
		\imply 
		\vary^1_2\langle 2 \rangle = v
	}~\textbf{Round}
	\and
	\inferrule
	{
		\empty
	}
	{
		\varz_1 = \clamp_B(\vary_1)
		\sim_{0}
		\varz_2 = \clamp_B(\vary_2)
		: 
		\vary^1_1\langle 1 \rangle < - (b + \Lambda) 
		\imply 
		\vary^1_2\langle 2 \rangle < - (b + \Lambda)
		\\\\  
		\Rightarrow 
			\varz^1_1\langle 1 \rangle = v
	\imply  = \varz_2^1\langle 2 \rangle = v
	}~\textbf{Null}
}
{
	\vary_1 = \round{\varx_1}_{\Lambda};
	\varz_1 = \clamp_B(\vary_1)
	\sim_{0} 
	\vary_2 = \round{\varx_2}_{\Lambda};
	\varz_2 = \clamp_B(\vary_2)
	:
		0 < \Big(\varx_1\langle 1 \rangle\Big)^1 < - (b + \frac{\Lambda}{2} )
		\imply 
		0 < \Big(\varx_2\langle 2 \rangle \Big)^1 < - (b + \frac{\Lambda}{2})
	\Rightarrow 
	\varz^1_1\langle 1 \rangle = v
	\imply  = \varz_2^1\langle 2 \rangle = v
}
\end{mathpar}
}
%
The assertion in the derivation is defined as:
\\
$\Phi \triangleq \rvalL_1 < 
u^1_1\langle 1 \rangle < \rvalR_1 \imply 
		\rvalL_2 < u^1_2\langle 2 \rangle < \rvalR_2$
\\
$\Phi' \triangleq 
\Phi[\varx_1/f(a) + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_1), \varx_2/f(a') + \frac{1}{\epsilon} \times s_2 \times \ln (\varu_2)] $
%
%
\subcaseL{
	$\boldsymbol{\round{f(a')}_{\Lambda} > 0 \land \valv \in (0, \round{f(a')}_{\Lambda}) } ~ (\star_1)$}
%
	Let $\valv_1 = \valv - (\frac{\Lambda}{2})$,
		$\valv_2 = \valv + (\frac{\Lambda}{2})$, 
		we know $\valv_1 > 0$, $\valv_2 > 0$.
\\
Let $\rvalL_1 = e^{\epsilon 
		(\frac{\valv_1}{1 + \eta} - \frac{f(a)}{(1 + \eta)^2})}$,
$\rvalL_2 = e^{\epsilon 
		(\frac{\valv_1}{1 + \eta} - \frac{f(a')}{(1 + \eta)^2})}$, 
$\rvalR_1 = e^{\epsilon 
				\big( \valv_2(1 + \eta) - f(a) (1 + \eta)^2) \big)}$
and $\rvalR_2 = e^{\epsilon 
				\big( \valv_2(1 + \eta) - f(a') (1 + \eta)^2) \big)}$.
	By the calculation in the Flopt Version proof, we have:
	\[
		e^0 < \frac{\rvalR_1 - \rvalL_1}{\rvalR_2 - \rvalL_2}
		\leq e^{\epsilon(12 \eta B + 1)}.
	\]
Then, we can instantiate the $\textbf{unif+}$ rule as:
{\scriptsize
\begin{mathpar}
	\inferrule
	{
		\inferrule
		{
			\forall \rvalL, \rvalR \in (0, 1]
		}
		{	\varu_1 \samplel \uniform(0,1)
			\sim_{\epsilon(12 \eta B + 1)} 
			\varu_2 \samplel \uniform(0,1)
			: 
			f(a) = f(a') + 1
			\Rightarrow 
			\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
			e^{\epsilon(12 \eta B + 1)} \rvalL \leq u^1_2\langle 2 \rangle \leq e^{\epsilon(12 \eta B + 1)}\rvalR
		}~\textbf{Unif+}
		\\ 
		f(a) = f(a') + 1 \Rightarrow f(a) = f(a') + 1
		\and
		\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
		\Big(e^{\epsilon(12 \eta B + 1)}\rvalL \leq u^1_2\langle 2 \rangle \leq e^{\epsilon(12 \eta B + 1)}\rvalR \Big)
		\Rightarrow
		\rvalL_1 < 
u^1_1\langle 1 \rangle < \rvalR_1 \imply 
		\rvalL_2 < u^1_2\langle 2 \rangle < \rvalR_2
	}
	{
		\varu_1 \samplel \uniform(0,1)
		\sim_{\epsilon(12 \eta B + 1)} 
		\varu_2 \samplel \uniform(0,1)
		: 
		f(a) = f(a') + 1
		\Rightarrow 
		\rvalL_1 < 
		u^1_1\langle 1 \rangle < \rvalR_1 \imply 
		\rvalL_2 < u^1_2\langle 2 \rangle < \rvalR_2
	}~\textbf{Conseq}
\end{mathpar}
}
Then, we have the following derivation exactly the same as previous cases.
%
%
\subcaseL{$\boldsymbol{\round{f(a')}_{\Lambda} > 0 \land \valv = 0 } $}
	%
	Let $\valv_1 = \valv - (\frac{\Lambda}{2})$,
	$\valv_2 = \valv  + (\frac{\Lambda}{2})$,
	we know $\valv_1 < 0$, $\valv_2 > 0$.
	By \textbf{Lemma 3} from the Flopt Version we have: $s = 1$.	%
	\\
	Let $\rvalL_1 = e^{\epsilon 
		(\frac{\valv_1}{(1 + \eta)^3} - \frac{f(a)}{(1 + \eta)^2})}$,
	$\rvalL_2 = e^{\epsilon 
		(\frac{\valv_1}{(1 + \eta)^3} - \frac{f(a')}{(1 + \eta)^2})}$, 
	$\rvalR_1 = e^{\epsilon 
					\big(\valv_2(1 + \eta) - f(a) (1 + \eta)^2) \big)}$
	and $\rvalR_2 = e^{\epsilon 
					\big(\valv_2(1 + \eta) - f(a') (1 + \eta)^2) \big)}$.
	By the calculation in the Flopt Version proof, we have:
	\[
		e^0 < \frac{\rvalR_1 - \rvalL_1}{\rvalR_2 - \rvalL_2}
		\leq e^{\epsilon(14 \eta B + 1)}.
	\]
	%
	%
Then, we can instantiate the $\textbf{unif+}$ rule as:
{\scriptsize
\begin{mathpar}
	\inferrule
	{
		\inferrule
		{
			\forall \rvalL, \rvalR \in (0, 1]
		}
		{	\varu_1 \samplel \uniform(0,1)
			\sim_{\epsilon(14 \eta B + 1)} 
			\varu_2 \samplel \uniform(0,1)
			: 
			f(a) = f(a') + 1
			\Rightarrow 
			\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
			e^{\epsilon(14 \eta B + 1)} \rvalL \leq u^1_2\langle 2 \rangle \leq e^{\epsilon(14 \eta B + 1)}\rvalR
		}~\textbf{Unif+}
		\\ 
		f(a) = f(a') + 1 \Rightarrow f(a) = f(a') + 1
		\and
		\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
		\Big(e^{\epsilon(14 \eta B + 1)}\rvalL \leq u^1_2\langle 2 \rangle \leq e^{\epsilon(14 \eta B + 1)}\rvalR \Big)
		\Rightarrow
		\rvalL_1 < 
u^1_1\langle 1 \rangle < \rvalR_1 \imply 
		\rvalL_2 < u^1_2\langle 2 \rangle < \rvalR_2
	}
	{
		\varu_1 \samplel \uniform(0,1)
		\sim_{\epsilon(14 \eta B + 1)} 
		\varu_2 \samplel \uniform(0,1)
		: 
		f(a) = f(a') + 1
		\Rightarrow 
		\rvalL_1 < 
		u^1_1\langle 1 \rangle < \rvalR_1 \imply 
		\rvalL_2 < u^1_2\langle 2 \rangle < \rvalR_2
	}~\textbf{Conseq}
\end{mathpar}
}
Then, we have the following derivation exactly the same as previous cases.
	%
	\caseL{$\boldsymbol{\valv = \round{f(a')}_{\Lambda}}$}
	%
	There are 3 subcases by induction on $\round{f(a')}_{\Lambda}$:
	$\round{f(a')}_{\Lambda} < 0$, $\round{f(a')}_{\Lambda} = 0$ and $\round{f(a')}_{\Lambda} > 0$. 
		\\
		%
	Without loss of generalization, 
	we consider the worst case where the error propagate in the same direction, i.e. $\round{f(a')}_{\Lambda} < 0$.
		%
		\\
		%
	Let $\valv_1 = \valv - \frac{\Lambda}{2}$, $\valv_2 = \valv + \frac{\Lambda}{2}$, we know $\valv_1 < 0$, $\valv_2 < 0$.
		%
	By \textbf{ Lemma. 3}, \textbf{ Lemma. 7 and  8} from the Flopt Version, we have:
	$s = 1$ or $-1$ and $\rvalR_2 = 1$.
	%
	\\
	%
	Let $\rvalL_1 = e^{\epsilon 
			(\frac{(\frac{\valv_1}{1 + \eta} - f(a))}{(1 + \eta)^2})}$,
	$\rvalL_2 = e^{\epsilon 
			(\frac{(\frac{\valv_1}{1 + \eta} - f(a'))}{(1 + \eta)^2})}$, 
	$\rvalR_1 = e^{\epsilon 
					\big((\valv_2(1 + \eta) - f(a)) (1 + \eta)^2) \big)}$
	and $\rvalR_2 = 1$.
	By the calculation in the Flopt Version proof, we have:
	\[
		e^0 < \frac{\rvalR_1 - \rvalL_1}{\rvalR_2 - \rvalL_2}
		\leq e^{\epsilon(12 \eta B + 1)} .
	\]
	%
	\\	
	%
	Then we have the derivation exactly the same as previous cases.
	%
	%
	\caseL{
	$\boldsymbol{\valv \in (\round{f(a')}_{\Lambda}, \round{f(a)}_{\Lambda})}$
	}
	%
	\caseL{$\boldsymbol{\valv = \round{f(a)}_{\Lambda}}$}
	%
	%
	\caseL{$\boldsymbol{\valv \in  (\round{f(a)}_{\Lambda}, B)}$}
	%
	%
	\subcaseL{
	$\boldsymbol{\round{f(a)}_{\Lambda} > 0 \lor \round{f(a)}_{\Lambda} < 0 \land \valv \in  (0, B)}$}
	%
	Let $\valv_1 = \valv - (\frac{\Lambda}{2})$,
		$\valv_2 = \valv + (\frac{\Lambda}{2})$, 
		we know $\valv_1 > 0$, $\valv_2 > 0$.
	\\
	Let $\rvalL_1 = e^{\epsilon 
			(\frac{f(a)}{(1 + \eta)^2} - \frac{\valv_1}{1 + \eta})}$,
	$\rvalL_2 = e^{\epsilon 
			(\frac{f(a')}{(1 + \eta)^2} - \frac{\valv_1}{1 + \eta})}$, 
	$\rvalR_1 = e^{\epsilon 
					\big( f(a) (1 + \eta)^2 - \valv_2(1 + \eta) \big)}$
	and $\rvalR_2 = e^{\epsilon 
					\big( f(a') (1 + \eta)^2 - \valv_2(1 + \eta) \big)}$.
		By the calculation in the Flopt Version proof, we have:
		\[
			e^0 < \frac{\rvalR_1 - \rvalL_1}{\rvalR_2 - \rvalL_2}
			\leq e^{\epsilon(12 \eta B + 1)}.
		\]
	Then, we can instantiate the $\textbf{unif-}$ rule as:
	{\scriptsize
	\begin{mathpar}
		\inferrule
		{
			\inferrule
			{
				\forall \rvalL, \rvalR \in (0, 1]
			}
			{	\varu_1 \samplel \uniform(0,1)
				\sim_{\epsilon(12 \eta B + 1)} 
				\varu_2 \samplel \uniform(0,1)
				: 
				f(a) = f(a') + 1
				\Rightarrow 
				\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
				e^{-\epsilon(12 \eta B + 1)} \rvalL \leq u^1_2\langle 2 \rangle \leq e^{-\epsilon(12 \eta B + 1)}\rvalR
			}~\textbf{Unif-}
			\\ 
			f(a) = f(a') + 1 \Rightarrow f(a) = f(a') + 1
			\and
			\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
			\Big(e^{-\epsilon(12 \eta B + 1)}\rvalL \leq u^1_2\langle 2 \rangle \leq e^{-\epsilon(12 \eta B + 1)}\rvalR \Big)
			\Rightarrow
			\rvalL_1 < 
	u^1_1\langle 1 \rangle < \rvalR_1 \imply 
			\rvalL_2 < u^1_2\langle 2 \rangle < \rvalR_2
		}
		{
			\varu_1 \samplel \uniform(0,1)
			\sim_{\epsilon(12 \eta B + 1)} 
			\varu_2 \samplel \uniform(0,1)
			: 
			f(a) = f(a') + 1
			\Rightarrow 
			\rvalL_1 < 
			u^1_1\langle 1 \rangle < \rvalR_1 \imply 
			\rvalL_2 < u^1_2\langle 2 \rangle < \rvalR_2
		}~\textbf{Conseq}
	\end{mathpar}
	}
	Then, we have the rest derivation exactly the same as previous cases.
	%
	%
	%
	\subcaseL{$\boldsymbol{\round{f(a)}_{\Lambda} < 0 \land \valv \in  (\round{f(a)}_{\Lambda}, 0)}$}
	%
	%
	Let $\valv_1 = \valv - (\frac{\Lambda}{2})$,
		$\valv_2 = \valv + (\frac{\Lambda}{2})$, 
		we know $\valv_1 < 0$, $\valv_2 < 0$.
	\\
	Let $\rvalL_1 = e^{\epsilon 
			(\frac{f(a)}{(1 + \eta)^2} - \frac{\valv_1}{(1 + \eta)^3})}$,
	$\rvalL_2 = e^{\epsilon 
			(\frac{f(a')}{(1 + \eta)^2} - \frac{\valv_1}{(1 + \eta)^3})}$, 
	$\rvalR_1 = e^{\epsilon 
					\big(f(a) (1 + \eta)^2 - \valv_2(1 + \eta)^3 \big)}$
	and $\rvalR_2 = e^{\epsilon 
					\big(f(a') (1 + \eta)^2 - \valv_2(1 + \eta)^3\big)}$.
		By the calculation in the Flopt Version proof, we have:
		\[
			e^0 < \frac{\rvalR_1 - \rvalL_1}{\rvalR_2 - \rvalL_2}
			\leq e^{\epsilon(12 \eta B + 1)}.
		\]
	Then, we can instantiate the $\textbf{unif-}$ rule as:
	{\scriptsize
	\begin{mathpar}
		\inferrule
		{
			\inferrule
			{
				\forall \rvalL, \rvalR \in (0, 1]
			}
			{	\varu_1 \samplel \uniform(0,1)
				\sim_{\epsilon(12 \eta B + 1)} 
				\varu_2 \samplel \uniform(0,1)
				: 
				f(a) = f(a') + 1
				\Rightarrow 
				\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
				e^{-\epsilon(12 \eta B + 1)} \rvalL \leq u^1_2\langle 2 \rangle \leq e^{-\epsilon(12 \eta B + 1)}\rvalR
			}~\textbf{Unif-}
			\\ 
			f(a) = f(a') + 1 \Rightarrow f(a) = f(a') + 1
			\and
			\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
			\Big(e^{-\epsilon(12 \eta B + 1)}\rvalL \leq u^1_2\langle 2 \rangle \leq e^{-\epsilon(12 \eta B + 1)}\rvalR \Big)
			\Rightarrow
			\rvalL_1 < 
	u^1_1\langle 1 \rangle < \rvalR_1 \imply 
			\rvalL_2 < u^1_2\langle 2 \rangle < \rvalR_2
		}
		{
			\varu_1 \samplel \uniform(0,1)
			\sim_{\epsilon(12 \eta B + 1)} 
			\varu_2 \samplel \uniform(0,1)
			: 
			f(a) = f(a') + 1
			\Rightarrow 
			\rvalL_1 < 
			u^1_1\langle 1 \rangle < \rvalR_1 \imply 
			\rvalL_2 < u^1_2\langle 2 \rangle < \rvalR_2
		}~\textbf{Conseq}
	\end{mathpar}
	}
	Then, we have the rest derivation exactly the same as previous cases.
	%
	%
	\subcaseL{$\boldsymbol{\round{f(a)}_{\Lambda} < 0 \land \valv = 0}$}
	%
	%
	Let $\valv_1 = \valv - (\frac{\Lambda}{2})$,
	$\valv_2 = \valv  + (\frac{\Lambda}{2})$,
	we know $\valv_1 < 0$, $\valv_2 > 0$.
	By \textbf{Lemma 3} from the Flopt Version we have: $s = 1$.	%
	\\
	Let $\rvalL_1 = e^{\epsilon 
		(\frac{f(a)}{(1 + \eta)^2} - \frac{\valv_1}{(1 + \eta)^3})}$,
	$\rvalL_2 = e^{\epsilon 
		(\frac{f(a')}{(1 + \eta)^2} - \frac{\valv_1}{(1 + \eta)^3})}$, 
	$\rvalR_1 = e^{\epsilon 
				\big( f(a) (1 + \eta)^2 - \valv_2(1 + \eta)) \big)}$
	and $\rvalR_2 = e^{\epsilon 
			\big( f(a') (1 + \eta)^2 - \valv_2(1 + \eta)) \big)}$.
	%
	%
Then, we can instantiate the $\textbf{unif-}$ rule as:
{\scriptsize
\begin{mathpar}
	\inferrule
	{
		\inferrule
		{
			\forall \rvalL, \rvalR \in (0, 1]
		}
		{	\varu_1 \samplel \uniform(0,1)
			\sim_{\epsilon(1 + \eta)^2} 
			\varu_2 \samplel \uniform(0,1)
			: 
			f(a) = f(a') + 1
			\Rightarrow 
			\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
			e^{-\epsilon(1 + \eta)^2} \rvalL \leq u^1_2\langle 2 \rangle \leq e^{-\epsilon(1 + \eta)^2}\rvalR
		}~\textbf{Unif-}
		\\ 
		f(a) = f(a') + 1 \Rightarrow f(a) = f(a') + 1
		\and
		\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
		\Big(e^{-\epsilon(1 + \eta)^2}\rvalL \leq u^1_2\langle 2 \rangle \leq e^{-\epsilon(1 + \eta)^2}\rvalR \Big)
		\Rightarrow
		\rvalL_1 < 
u^1_1\langle 1 \rangle < \rvalR_1 \imply 
		\rvalL_2 < u^1_2\langle 2 \rangle < \rvalR_2
	}
	{
		\varu_1 \samplel \uniform(0,1)
		\sim_{\epsilon(1 + \eta)^2} 
		\varu_2 \samplel \uniform(0,1)
		: 
		f(a) = f(a') + 1
		\Rightarrow 
		\rvalL_1 < 
		u^1_1\langle 1 \rangle < \rvalR_1 \imply 
		\rvalL_2 < u^1_2\langle 2 \rangle < \rvalR_2
	}~\textbf{Conseq}
\end{mathpar}
}
Then, we have the rest derivation exactly the same as previous cases.
	%
	\caseL{$\boldsymbol{\valv = B}$}
	%
	Let $b$ be the largest number rounded by $\Lambda$ that is smaller than $B$.
%
\\
Let $\rvalL_1 = \rvalL_2 = 0$, 
$\rvalR_1 = e^{\epsilon 
		(f(a) - (b + \Lambda / 2)/(1 + \eta))(1 + \eta)^2}$
and $\rvalR_2 = e^{\epsilon 
		(f(a') - (b + \Lambda / 2)/(1 + \eta))(1 + \eta)^2}$.
		\\
Then, we can instantiate the $\textbf{unif-}$ rule as:
%
{\tiny
\begin{mathpar}
	\inferrule
	{
		\inferrule
		{
			\forall \rvalL, \rvalR \in (0, 1]
		}
		{	\varu_1 \samplel \uniform(0,1)
			\sim_{\epsilon(1 + \eta)^2} 
			\varu_2 \samplel \uniform(0,1)
			: 
			f(a) = f(a') + 1
			\Rightarrow 
			\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR \imply 
			\Big(e^{-\epsilon(1 + \eta)^2}\rvalL \leq u^1_2\langle 2 \rangle \leq e^{-\epsilon(1 + \eta)^2} \land u^1_2\langle 2 \rangle \leq \rvalR \Big)
		}~\textbf{Unif-}
		\\ 
		f(a) = f(a') + 1 \Rightarrow f(a) = f(a') + 1
		\and
		\rvalL \leq u^1_1\langle 1 \rangle \leq \rvalR 
		\imply 
		\Big(e^{-\epsilon(1 + \eta)^2}\rvalL \leq u^1_2\langle 2 \rangle \leq e^{-\epsilon(1 + \eta)^2} \land u^1_2\langle 2 \rangle \leq \rvalR \Big)
		\Rightarrow
		0 < u^1_1\langle 1 \rangle < \rvalR_1 \imply 
		0 < u^1_2\langle 2 \rangle < \rvalR_2
	}
	{
		\varu_1 \samplel \uniform(0,1)
		\sim_{\epsilon(1 + \eta)^2} 
		\varu_2 \samplel \uniform(0,1)
		: 
		f(a) = f(a') + 1
		\Rightarrow 
		0 < u^1_1\langle 1 \rangle < \rvalR_1 \imply 
		0 < u^1_2\langle 2 \rangle < \rvalR_2
	}~\textbf{Conseq}
\end{mathpar}
}
Then, we have the rest derivation exactly the same as previous cases.
\end{itemize}


\end{proof}

\newpage
\bibliographystyle{plain}
\bibliography{verifysnap.bib}

\end{document}



